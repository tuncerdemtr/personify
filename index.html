<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ƒ∞ntema Mutfak Dijital Mimar Asistanƒ±</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #F9FAFB;
      --card-bg: #FFFFFF;
      --text: #111827;
      --muted: #6B7280;
      --muted-light: #9CA3AF;
      --border: #E5E7EB;
      --border-hover: #D1D5DB;
      --primary: #2563EB;
      --primary-hover: #1D4ED8;
      --primary-bg: #EFF6FF;
      --danger: #EF4444;
      --danger-bg: #FEF2F2;
      --success: #10B981;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 8px;
      --radius-lg: 12px;
      --maxw: 1200px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 24px 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      min-height: 100vh;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 20px;
    }

    .brand{
      display:flex; flex-direction:column; gap:4px;
    }
    .brand .kicker{
      font-size: 11px;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .brand h1{
      margin:0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }
    .brand p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
    }

    .topActions{
      display:flex;
      gap:12px;
      align-items:center;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 13px;
      font-weight: 500;
    }
    .pill strong{ color: var(--text); font-weight: 600; }

    .btn{
      height: 40px;
      padding: 0 16px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      cursor:pointer;
      transition: all .2s ease;
    }
    .btn:hover{
      background: var(--bg);
      border-color: var(--border-hover);
    }
    .btn:active{ transform: translateY(1px); }
    .btn:focus{ outline:none; box-shadow: 0 0 0 3px var(--primary-bg); border-color: var(--primary); }
    
    .btn.primary{
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    .btn.primary:hover{
      background: var(--primary-hover);
      border-color: var(--primary-hover);
    }
    
    .btn.danger{
      background: var(--card-bg);
      color: var(--danger);
      border-color: var(--border);
    }
    .btn.danger:hover{
      background: var(--danger-bg);
      border-color: #FECACA;
    }
    .btn.ghost{
      background: transparent;
      border-color: transparent;
      color: var(--muted);
    }
    .btn.ghost:hover{
      background: var(--bg);
      color: var(--text);
    }

    .card{
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      overflow:hidden;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }
    
    /* Result Dashboard Layout - Override max-width for dashboard */
    .wrap:has(.dashboard-grid) .card {
      max-width: 100%;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    .cardHeader{
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: white;
    }
    .cardHeader h2{
      margin:0;
      font-size: 16px;
      font-weight: 600;
    }
    .cardHeader .sub{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      margin-top:2px;
    }
    .cardBody{ padding: 24px; background: white; }

    .stack{
      display:flex;
      flex-direction:column;
      gap: 20px;
    }

    .fieldRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 600px){
      .fieldRow{ grid-template-columns: 1fr; }
      header { flex-direction: column; align-items: flex-start; }
      .topActions { width: 100%; justify-content: space-between; }
    }

    label{
      display:flex;
      flex-direction:column;
      gap: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
    }

    input[type="text"], input[type="tel"], input[type="email"], textarea{
      width:100%;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: white;
      color: var(--text);
      padding: 10px 12px;
      font-size: 14px;
      outline:none;
      font-family: inherit;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    textarea{ min-height: 100px; resize: vertical; }
    input:focus, textarea:focus{
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-bg);
    }
    .hint{
      color: var(--muted);
      font-size: 12px;
    }

    .progressWrap{
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      background: white;
    }
    .progressLeft{
      display:flex;
      flex-direction:column;
      gap: 4px;
    }
    .qMeta{
      color: var(--muted);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .qText{
      font-size: 20px;
      font-weight: 700;
      margin:0;
      color: var(--text);
    }
    .bar{
      width: 200px;
      height: 8px;
      border-radius: 999px;
      background: var(--bg);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: var(--primary);
      transition: width .3s ease;
    }

    .options{
      display:grid;
      gap: 12px;
    }
    .opt{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: white;
      padding: 16px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      cursor:pointer;
      transition: all .15s ease;
    }
    .opt:hover{ border-color: var(--primary); background: var(--primary-bg); }
    .opt.sel{
      background: var(--primary-bg);
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary);
    }
    .opt .t{
      font-size: 15px;
      font-weight: 500;
      color: var(--text);
    }
    .opt .tag{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }
    .opt .mark{
      width: 20px; height: 20px;
      border-radius: 50%;
      border: 1px solid var(--border-hover);
      background: white;
      flex: 0 0 auto;
      position:relative;
      margin-top: 2px;
    }
    .opt.sel .mark{
      border-color: var(--primary);
      background: var(--primary);
    }
    .opt.sel .mark::after{
      content:"";
      position:absolute; inset: 0;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z' clip-rule='evenodd'/%3E%3C/svg%3E");
    }
    .opt.multi .mark{ border-radius: 4px; }
    .opt.multi.sel .mark{ border-radius: 4px; }

    .navRow{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      grid-template-rows: auto auto;
      gap: 24px;
      width: 100%;
    }
    
    .dashboard-hero {
      grid-column: 1 / -1;
      background: white;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 1fr;
    }
    
    .hero-img {
      height: 100%;
      min-height: 300px;
      width: 100%;
    }
    .hero-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .hero-content {
      padding: 32px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 16px;
    }
    .hero-content h2 {
      margin: 0;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: -0.03em;
      line-height: 1.1;
    }
    .hero-desc {
      color: var(--muted);
      font-size: 16px;
      line-height: 1.6;
    }
    
    .dash-panel {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .dash-panel h3 {
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
    }
    
    @media (max-width: 900px) {
      .dashboard-grid { grid-template-columns: 1fr; }
      .dashboard-hero { grid-template-columns: 1fr; }
      .hero-img { height: 240px; }
    }

    .swatchGrid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }
    .swatch{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--bg);
      font-size: 13px;
      color: var(--text);
      font-weight: 500;
    }
    .swatchDot{
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 1px solid var(--border);
      flex: 0 0 auto;
    }

    .checklist{
      list-style:none;
      padding:0;
      margin:0;
      display:grid;
      gap: 10px;
    }
    .checklist li{
      display:flex;
      align-items:flex-start;
      gap: 10px;
      font-size: 14px;
      color: var(--text);
      line-height: 1.4;
    }
    .checklist li::before{
      content:"‚úì";
      color: var(--success);
      font-weight: 800;
    }

    .accGrid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 16px;
    }
    .accCard{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--bg);
      display: flex;
      flex-direction: column;
    }
    .accImg{
      width: 100%;
      height: 100px;
      object-fit: cover;
      display: block;
      background: #eee;
    }
    .accText{
      padding: 10px;
      font-size: 12px;
      line-height: 1.35;
      color: var(--text);
      font-weight: 500;
    }

    .arch-note {
      font-style: italic;
      color: var(--muted);
      border-left: 3px solid var(--primary);
      padding-left: 12px;
      margin-top: 12px;
      font-size: 14px;
      background: var(--primary-bg);
      padding: 12px;
      border-radius: 0 var(--radius) var(--radius) 0;
    }

    .layout-sugg {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text);
      margin-top: 12px;
      font-weight: 500;
    }
    
    .warranty-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #ECFDF5;
      color: #047857;
      border: 1px solid #A7F3D0;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      margin-top: 8px;
    }

    .mat-info {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .mat-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }
    .mat-desc {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
    }

    .footerNote{
      color: var(--muted-light);
      font-size: 12px;
      text-align: center;
      margin-top: auto;
    }
    
    .spinner {
      border: 3px solid var(--border);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    .loadingWrap {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 20px;
      padding: 60px;
    }

    .screen { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="kicker">Sales Point Tablet App</div>
        <h1>ƒ∞ntema Mutfak Dijital Mimar Asistanƒ±</h1>
        <p>14 soruluk akƒ±≈ü. 7 persona skoru. Sonu√ß ekranƒ±nda ki≈üisel model ve aksesuar √∂nerisi √∂ne √ßƒ±kar.</p>
      </div>
      <div class="topActions">
        <div class="pill" id="sessionPill"><strong>Oturum:</strong> <span id="sessionState">Yeni</span></div>
        <button class="btn ghost" id="btnNew">Yeni G√∂r√º≈üme</button>
        <button class="btn danger" id="btnReset">Sƒ±fƒ±rla</button>
      </div>
    </header>

    <div class="card" id="mainCard"></div>

    <div class="footerNote">
      Bu uygulama tek dosya √ßalƒ±≈üƒ±r. Veri sadece bu cihazƒ±n tarayƒ±cƒ±sƒ±nda saklanƒ±r (LocalStorage).
    </div>
  </div>

  <script>
    // --- REVƒ∞ZE EDƒ∞LMƒ∞≈û DENGELƒ∞ SORU HAVUZU (MAX PUAN ~100 E≈ûƒ∞TLENDƒ∞) ---
    const questions = [
      {
        id: 1, text: "Bu mutfak projesinin niteliƒüi nedir?", type: "single",
        options: [
          { text: "Kendi evim / Tadilat", scores: { konforodakli: 12, dogalruh: 6 } },
          { text: "Yeni Ev / Sƒ±fƒ±r Proje", scores: { sehirlivizyoner: 14, klasikluk: 10 } },
          { text: "Yatƒ±rƒ±m / St√ºdyo / Kiraya verilecek", scores: { hizpratik: 26 } },
          { text: "Yazlƒ±k / ƒ∞kinci Ev", scores: { sahilruhu: 28 } }
        ]
      },
      {
        id: 2, text: "Zaman kƒ±sƒ±tƒ±nƒ±z nedir?", type: "single",
        options: [
          { text: "√áok acil, hemen bitmeli", scores: { hizpratik: 30 } },
          { text: "Standart s√ºre√ß (1-2 ay)", scores: { konforodakli: 12 } },
          { text: "Zaman sorun deƒüil, m√ºkemmel olsun", scores: { klasikluk: 14, dogalruh: 10, sehirlivizyoner: 8 } }
        ]
      },
      {
        id: 3, text: "Mutfak alanƒ±nƒ±n durumu?", type: "single",
        options: [
          { text: "Dar / K√º√ß√ºk", scores: { hizpratik: 20 } },
          { text: "Geni≈ü / Ada M√ºsait", scores: { sehirlivizyoner: 14, klasikluk: 12, sahilruhu: 8 } },
          { text: "Standart", scores: { konforodakli: 10 } }
        ]
      },
      {
        id: 4, text: "Hane Halkƒ± (Birden fazla se√ßebilirsiniz)", type: "multi",
        options: [
          { text: "Yalnƒ±z / √áift", scores: { sehirlivizyoner: 10, hizpratik: 8 } },
          { text: "√áocuklar Var", scores: { konforodakli: 18 } },
          { text: "Evcil Hayvan Var", scores: { dogalruh: 12, konforodakli: 6 } },
          { text: "Kalabalƒ±k Aile", scores: { konforodakli: 12, nostaljik: 8 } }
        ]
      },
      {
        id: 5, text: "Mutfak sizin i√ßin ne ifade ediyor?", type: "single",
        options: [
          { text: "Vitrin (Sosyal Alan)", scores: { sehirlivizyoner: 20, klasikluk: 12 } },
          { text: "Operasyon (Yemek Yapma)", scores: { hizpratik: 14 } },
          { text: "Sƒ±ƒüƒ±nak (Huzur)", scores: { dogalruh: 18 } },
          { text: "Kalp (Aile Odaklƒ±)", scores: { konforodakli: 16, nostaljik: 12 } },
          { text: "ƒ∞stasyon (Pratik)", scores: { hizpratik: 18 } }
        ]
      },
      {
        id: 6, text: "≈ûu anki mutfakta en b√ºy√ºk ≈üikayetiniz?", type: "single",
        options: [
          { text: "Daƒüƒ±nƒ±klƒ±k / Yer yok", scores: { konforodakli: 16 } },
          { text: "Temizlik Zorluƒüu / Lekeler", scores: { konforodakli: 12, hizpratik: 8 } },
          { text: "Demode G√∂r√ºn√ºm", scores: { sehirlivizyoner: 12, klasikluk: 10, nostaljik: 6 } },
          { text: "Karanlƒ±k / Basƒ±k", scores: { dogalruh: 12, sahilruhu: 12 } }
        ]
      },
      {
        id: 7, text: "Hangi tasarƒ±m dili size yakƒ±n?", type: "single",
        options: [
          { text: "Modern & Minimal", scores: { sehirlivizyoner: 18, hizpratik: 8 } },
          { text: "Klasik & G√∂steri≈üli", scores: { klasikluk: 22 } },
          { text: "Country & Doƒüal", scores: { dogalruh: 18, nostaljik: 14, sahilruhu: 10 } },
          { text: "End√ºstriyel", scores: { sehirlivizyoner: 12, hizpratik: 10 } }
        ]
      },
      {
        id: 8, text: "Malzeme ve Doku tercihiniz?", type: "single",
        options: [
          { text: "Doƒüal Ah≈üap Dokusu", scores: { dogalruh: 20, nostaljik: 10 } },
          { text: "Mat ve Soft Renkler", scores: { konforodakli: 12, sahilruhu: 10 } },
          { text: "Parlak ve Canlƒ±", scores: { klasikluk: 18 } },
          { text: "Koyu ve Mask√ºlen", scores: { sehirlivizyoner: 16 } }
        ]
      },
      {
        id: 9, text: "Yemek pi≈üirme alƒ±≈ükanlƒ±ƒüƒ±nƒ±z?", type: "single",
        options: [
          { text: "Standart Pi≈üirme", scores: { konforodakli: 10 } },
          { text: "Gurme / Profesyonel", scores: { sehirlivizyoner: 10, klasikluk: 8 } },
          { text: "Minimum / Pratik", scores: { hizpratik: 18 } }
        ]
      },
      {
        id: 10, text: "Depolama ihtiyacƒ±nƒ±z?", type: "single",
        options: [
          { text: "Maksimum Kiler / Stok", scores: { konforodakli: 18 } },
          { text: "Vitrin / Sergileme", scores: { klasikluk: 16, sehirlivizyoner: 10 } },
          { text: "Standart / Kapalƒ± Dolap", scores: { hizpratik: 10 } }
        ]
      },
      {
        id: 11, text: "S√ºrd√ºr√ºlebilirlik √∂nceliƒüiniz?", type: "single",
        options: [
          { text: "√áok √ñnemli / Vazge√ßilmez", scores: { dogalruh: 28 } },
          { text: "√ñnemli ama estetik de √∂nemli", scores: { dogalruh: 12, sahilruhu: 8, konforodakli: 6 } },
          { text: "√ñncelik Deƒüil", scores: { hizpratik: 8 } }
        ]
      },
      {
        id: 12, text: "Teknoloji entegrasyonu?", type: "single",
        options: [
          { text: "High-Tech (Akƒ±llƒ± sistemler)", scores: { sehirlivizyoner: 22 } },
          { text: "Geleneksel / Manuel", scores: { nostaljik: 16, klasikluk: 12 } }
        ]
      },
      {
        id: 13, text: "B√ºt√ße yakla≈üƒ±mƒ±nƒ±z?", type: "single",
        options: [
          { text: "Esnek / Prestij Odaklƒ±", scores: { klasikluk: 20, sehirlivizyoner: 12 } },
          { text: "Fiyat / Performans", scores: { konforodakli: 14, hizpratik: 12 } },
          { text: "Ekonomik / B√ºt√ße Dostu", scores: { hizpratik: 18 } }
        ]
      },
      {
        id: 14, text: "Karar verme fakt√∂r√ºn√ºz?", type: "single",
        options: [
          { text: "Tasarƒ±m Heyecanƒ±", scores: { sehirlivizyoner: 12, klasikluk: 8 } },
          { text: "G√ºven / Garanti", scores: { konforodakli: 12 } },
          { text: "Hƒ±z / Teslimat", scores: { hizpratik: 16 } },
          { text: "Maliyet", scores: { hizpratik: 10 } }
        ]
      }
    ];

    // Persona verisi: sonu√ß ekranƒ±ndaki aksesuar, renk, malzeme √∂nerileri buradan gelir
    const personasList = [
      {
        id: "sehirlivizyoner",
        title: "≈ûehirli Vizyoner (The Urban Visionary)",
        description: "Mutfak senin i√ßin bir vitrin. Trendleri takip ediyor, teknolojiyi ve modernizmi seviyorsun.",
        recommendedModel: "Inova",
        architectNote: "Se√ßimlerinizdeki 'teknoloji' ve 'sosyalle≈üme' vurgusu, entegre aydƒ±nlatma sistemleri ve kulpsuz tasarƒ±mƒ±yla Inova modelini i≈üaret ediyor.",
        layoutSuggestion: "Ada Mutfak (Island) Yerle≈üimi: Misafirlerinizi aƒüƒ±rlarken y√ºz√ºn√ºz√ºn onlara d√∂n√ºk olmasƒ± i√ßin ideal.",
        warrantyInfo: "2 Yƒ±l Garanti (Mat Lake Y√ºzey Teknolojisi)",
        materialTech: "ƒ∞pek Mat Lake & Anti-Fingerprint",
        materialDesc: "P√ºr√ºzs√ºz, parmak izi bƒ±rakmayan ve ipeksi dokuya sahip mat y√ºzeyler.",
        colors: [
          { code: "M104", name: "Grafit (Mat)" },
          { code: "M007", name: "Siyah (Mat)" },
          { code: "T112", name: "Koyu Taupe" }
        ],
        accessories: [
          "Kulpsuz Gola Profil Sistemi (Mat Siyah)",
          "Hareket Sens√∂rl√º LED Aydƒ±nlatma (G√∂vde ƒ∞√ßi)",
          "Blum Antaro √áekmece ƒ∞√ßi D√ºzenleyici (Orion Gri)"
        ],
        imageQuery: "modern dark graphite luxury kitchen with led lights"
      },
      {
        id: "klasikluk",
        title: "Klasik L√ºks Sever (The Heritage Luxury)",
        description: "Kalite asla modasƒ± ge√ßmeyen bir yatƒ±rƒ±mdƒ±r. Geleneksel √ßizgilerin aƒüƒ±rba≈ülƒ±lƒ±ƒüƒ±nƒ± arƒ±yorsun.",
        recommendedModel: "Toscana",
        architectNote: "Geleneksel detaylara verdiƒüiniz √∂nem ve g√∂steri≈üli aksesuar tercihiniz, √ßer√ßeveli kapak yapƒ±sƒ±yla Toscana modelinde hayat buluyor.",
        layoutSuggestion: "Simetrik U Tipi Yerle≈üim: Klasik tasarƒ±mƒ±n aƒüƒ±rlƒ±ƒüƒ±nƒ± ve d√ºzenini en iyi yansƒ±tan plan.",
        warrantyInfo: "2 Yƒ±l Garanti (√ñzel ƒ∞≈ü√ßilikli Lake)",
        materialTech: "7 Kat Cila Uygulanmƒ±≈ü Parlak/Mat Lake",
        materialDesc: "El i≈ü√ßiliƒüi ile boyanan, derinlik hissi veren ve zamanla sararmayan premium lake.",
        colors: [
          { code: "P019", name: "Orman Ye≈üili" },
          { code: "P020", name: "Uzay Mavi" },
          { code: "P017", name: "ƒ∞nci Beyaz" }
        ],
        accessories: [
          "Gold (Altƒ±n) Kulp - Kod: MKGDK33FP0032",
          "Klasik Ta√ß ve I≈üƒ±k Bandƒ± Profilleri",
          "B√ºfe Tipi Camlƒ± √úst Dolaplar (Sable Cam)"
        ],
        imageQuery: "classic green luxury kitchen cabinets gold handles"
      },
      {
        id: "konforodakli",
        title: "Konfor Odaklƒ± Aile (The Comfort Family)",
        description: "Mutfak evin kalbidir. Senin i√ßin dayanƒ±klƒ±lƒ±k, temizlik kolaylƒ±ƒüƒ± ve bolca saklama alanƒ± her ≈üeyden √∂nemli.",
        recommendedModel: "Siena",
        architectNote: "Yoƒüun kullanƒ±m ve temizlik kolaylƒ±ƒüƒ± talebiniz, √ßizilmelere kar≈üƒ± en dayanƒ±klƒ± seri olan Siena'yƒ± sizin i√ßin vazge√ßilmez kƒ±lƒ±yor.",
        layoutSuggestion: "Geni≈ü L Tipi + Masa: Aile kahvaltƒ±larƒ± ve rahat hareket alanƒ± i√ßin en ergonomik √ß√∂z√ºm.",
        warrantyInfo: "7 Yƒ±l Garanti (Akrilik & PET Y√ºzeyler)",
        materialTech: "Ultra Dayanƒ±klƒ± Akrilik & PET",
        materialDesc: "√áizilmelere, neme ve UV ƒ±≈üƒ±nlarƒ±na kar≈üƒ± ekstra diren√ßli, kolay temizlenen y√ºzey.",
        colors: [
          { code: "T125", name: "Manolya" },
          { code: "T123", name: "Ka≈ümir" },
          { code: "T122", name: "A√ßƒ±k Gri" }
        ],
        accessories: [
          "Boy Kiler Mekanizmasƒ± (Tam A√ßƒ±lƒ±m)",
          "Fasulye K√∂≈üe Mekanizmasƒ± (K√∂r K√∂≈üe √á√∂z√ºm√º)",
          "Tezgah Altƒ± √á√∂p Kovasƒ± Sistemleri"
        ],
        imageQuery: "cozy family kitchen beige cabinets bright",
        heroImage: "https://res.cloudinary.com/drp4askpq/image/upload/v1767146955/28daf619-3a8a-4dcf-afea-c917906d0104_bmgtbn.jpg"
      },
      {
        id: "dogalruh",
        title: "Doƒüal Ruh (The Natural Soul)",
        description: "Evin senin sƒ±ƒüƒ±naƒüƒ±n. Doƒüal dokular, ah≈üap sƒ±caklƒ±ƒüƒ± ve s√ºrd√ºr√ºlebilirlik √∂nceliƒüin.",
        recommendedModel: "Norda",
        architectNote: "Doƒüaya d√∂n√º≈ü arzunuz ve s√ºrd√ºr√ºlebilirlik hassasiyetiniz, ger√ßek ah≈üap kaplama olan Norda serisiyle tam uyum saƒülƒ±yor.",
        layoutSuggestion: "A√ßƒ±k Plan + Yarƒ±mada: Ya≈üam alanƒ±yla b√ºt√ºnle≈üen, bitkilerle zenginle≈ütirilmi≈ü ferah bir akƒ±≈ü.",
        warrantyInfo: "2 Yƒ±l Garanti (Doƒüal Ah≈üap Kaplama)",
        materialTech: "Doƒüal Ah≈üap Kaplama",
        materialDesc: "Ger√ßek aƒüa√ß dokusunu hissedebileceƒüiniz, ya≈üayan ve nefes alan doƒüal kaplama.",
        colors: [
          { code: "W009", name: "D√º≈üey Hareli Naturel Me≈üe" },
          { code: "T1_121", name: "Ada√ßayƒ± Ye≈üili" },
          { code: "M023", name: "Beton Ye≈üili" }
        ],
        accessories: [
          "Ah≈üap √áekmece ƒ∞√ßi Ka≈üƒ±klƒ±k (Di≈übudak)",
          "Metal √áer√ßeveli Ah≈üap A√ßƒ±k Raf √úniteleri",
          "Bitki Yeti≈ütirme Mod√ºl√º (Micro Garden)"
        ],
        imageQuery: "scandinavian kitchen light wood green plants"
      },
      {
        id: "hizpratik",
        title: "Hƒ±z ve Pratiklik Odaklƒ± (The Smart Investor)",
        description: "Kararƒ±nƒ± verdin, sonu√ß istiyorsun. Hƒ±zlƒ±, ekonomik ama ≈üƒ±k √ß√∂z√ºmler tam sana g√∂re.",
        recommendedModel: "Prime",
        architectNote: "B√ºt√ße ve hƒ±z √∂nceliƒüiniz, stoklu renkleri ve mod√ºler yapƒ±sƒ±yla en hƒ±zlƒ± teslim edilen Prime serisini i≈üaret ediyor.",
        layoutSuggestion: "Kompakt D√ºz (I Tipi) Yerle≈üim: Minimum alanda maksimum fonksiyon saƒülayan st√ºdyo tipi √ß√∂z√ºm.",
        warrantyInfo: "2 Yƒ±l Garanti (Laminant & Melamin)",
        materialTech: "Y√ºksek Basƒ±n√ßlƒ± Laminat (HPL)",
        materialDesc: "Darbelere dayanƒ±klƒ±, uzun √∂m√ºrl√º, ekonomik ve geni≈ü renk se√ßenekli teknolojik y√ºzey.",
        colors: [
          { code: "M104", name: "Grafit" },
          { code: "M103", name: "Latte" },
          { code: "M101", name: "Mat Beyaz" }
        ],
        accessories: [
          "A√ßƒ±lƒ±r Masa Mekanizmasƒ± (Space Saver)",
          "Tezgah Arasƒ± Ray Sistemi (Askƒ± Elemanlarƒ±)",
          "Entegre Kulp (Kapak Kendinden Kulplu)"
        ],
        imageQuery: "compact modern kitchen studio apartment"
      },
      {
        id: "nostaljik",
        title: "Nostaljik Romantik (The Vintage Lover)",
        description: "Ge√ßmi≈üin sƒ±caklƒ±ƒüƒ±, bug√ºn√ºn konforu. 'Anne mutfaƒüƒ±' sƒ±caklƒ±ƒüƒ±nda bir yer.",
        recommendedModel: "Vega",
        architectNote: "Ge√ßmi≈üe duyduƒüunuz √∂zlem ve sƒ±caklƒ±k arayƒ±≈üƒ±, Vega'nƒ±n rustik detaylarƒ± ve pastel tonlarƒ±yla √∂rt√º≈ü√ºyor.",
        layoutSuggestion: "Baƒüƒ±msƒ±z Mutfak (Kapalƒ± Plan): Yemek masasƒ±nƒ±n merkezde olduƒüu, sƒ±cak ve samimi bir atmosfer.",
        warrantyInfo: "3 Yƒ±l Garanti (Polimerik Kapak)",
        materialTech: "Polimerik & Mat Lake",
        materialDesc: "P√ºr√ºzs√ºz y√ºzey √ºzerine i≈ülenmi≈ü klasik detaylar, neme dayanƒ±klƒ± kaplama.",
        colors: [
          { code: "V1_M021", name: "Baltƒ±k Mavi" },
          { code: "T125", name: "Manolya" },
          { code: "V1_M024", name: "Buz Gri" }
        ],
        accessories: [
          "Antik Kulp (Eskitme) - Kod: MKGAK24MS0128",
          "Ah≈üap Tabaklƒ±k Rafƒ± (Terek)",
          "Kafesli Tel Dolap Kapaklarƒ±"
        ],
        imageQuery: "vintage blue country kitchen rustic style"
      },
      {
        id: "sahilruhu",
        title: "Yazlƒ±k Ruhu (The Coastal Dreamer)",
        description: "≈ûehirde bile olsan mutfaƒüƒ±nda bir sahil evi ferahlƒ±ƒüƒ± arƒ±yorsun.",
        recommendedModel: "Fresca",
        architectNote: "Ferahlƒ±k ve aydƒ±nlƒ±k arayƒ±≈üƒ±nƒ±z, Fresca'nƒ±n marin esintili √ßizgili kapaklarƒ±yla m√ºkemmel bir uyum i√ßinde.",
        layoutSuggestion: "Pencere √ñn√º Eviye Yerle≈üimi: Dƒ±≈üarƒ±yla baƒülantƒ± kuran, bol ƒ±≈üƒ±k alan ferah bir d√ºzen.",
        warrantyInfo: "2 Yƒ±l Garanti (Soft Touch Lake)",
        materialTech: "Soft Touch Mat Lake",
        materialDesc: "D√º≈üey fuga hareketleri verilmi≈ü, yumu≈üak dokulu mat lake y√ºzeyler.",
        colors: [
          { code: "F1_M021", name: "Baltƒ±k Mavi" },
          { code: "F1_M001", name: "Buz Beyaz" },
          { code: "T1_120", name: "Baltƒ±k Mavi" }
        ],
        accessories: [
          "Krom Kulp - Kod: MKGDK02EB0026",
          "Camlƒ± √úst Dolaplar (Buzlu Cam)",
          "A√ßƒ±k Mavi/Beyaz Raf Sistemleri"
        ],
        imageQuery: "coastal kitchen blue striped cabinets bright"
      }
    ];

    const personas = Object.fromEntries(personasList.map(p => [p.id, p]));
    const personaOrder = [
      "sehirlivizyoner",
      "klasikluk",
      "konforodakli",
      "dogalruh",
      "hizpratik",
      "nostaljik",
      "sahilruhu"
    ];

    const STORAGE_KEY = "intema_mimar_asistan_v4";

    const state = {
      step: "start",
      qIndex: 0,
      answers: {},
      meta: { name:"", phone:"", email:"", note:"" }
    };

    let loadingTimer = null;

    const el = (sel, root=document) => root.querySelector(sel);
    const els = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function deepClone(o){ return JSON.parse(JSON.stringify(o)); }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(deepClone(state)));
      updateSessionPill();
      updateSideSummary();
    }

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return false;
        const payload = JSON.parse(raw);
        if(!payload || typeof payload !== "object") return false;
        Object.assign(state, payload);
        return true;
      }catch(e){
        return false;
      }
    }

    function clearStorage(){ localStorage.removeItem(STORAGE_KEY); }

    function resetAll({ keepMeta=false } = {}){
      const preserved = keepMeta ? deepClone(state.meta) : { name:"", phone:"", email:"", note:"" };
      state.step = "start";
      state.qIndex = 0;
      state.answers = {};
      state.meta = preserved;
      if(loadingTimer){
        clearTimeout(loadingTimer);
        loadingTimer = null;
      }
      save();
      render();
    }

    function startQuiz(){
      state.step = "quiz";
      state.qIndex = Math.max(0, Math.min(state.qIndex || 0, questions.length - 1));
      save();
      render();
    }

    function startLoadingResult(){
      state.step = "loading";
      save();
      render();
      if(loadingTimer){
        clearTimeout(loadingTimer);
      }
      loadingTimer = setTimeout(()=>{
        state.step = "result";
        save();
        render();
      }, 2000);
    }

    function currentQuestion(){ return questions[state.qIndex]; }

    function isAnswered(q){
      const a = state.answers[q.id];
      if(q.type === "single") return typeof a === "number";
      if(q.type === "multi") return Array.isArray(a) && a.length > 0;
      return false;
    }

    function selectOption(q, optIndex){
      if(q.type === "single"){
        state.answers[q.id] = optIndex;
      }else{
        const cur = Array.isArray(state.answers[q.id]) ? state.answers[q.id] : [];
        state.answers[q.id] = cur.includes(optIndex) ? cur.filter(i=>i!==optIndex) : [...cur, optIndex];
      }
      save();
      render();
    }

    function totalProgress(){
      const answeredCount = questions.reduce((acc,q)=>acc + (isAnswered(q)?1:0), 0);
      return { answeredCount, total: questions.length };
    }

    function calcScores(){
      const scores = {};
      const contrib = {};
      personaOrder.forEach(p => scores[p] = 0);

      for(const q of questions){
        const ans = state.answers[q.id];
        if(ans === undefined) continue;

        contrib[q.id] = {};
        personaOrder.forEach(p => contrib[q.id][p] = 0);

        if(q.type === "single"){
          const opt = q.options[ans];
          if(opt && opt.scores){
            for(const [p,val] of Object.entries(opt.scores)){
              if(scores[p] === undefined) continue;
              scores[p] += val;
              contrib[q.id][p] += val;
            }
          }
        }else if(q.type === "multi"){
          const arr = Array.isArray(ans) ? ans : [];
          for(const idx of arr){
            const opt = q.options[idx];
            if(opt && opt.scores){
              for(const [p,val] of Object.entries(opt.scores)){
                if(scores[p] === undefined) continue;
                scores[p] += val;
                contrib[q.id][p] += val;
              }
            }
          }
        }
      }

      const total = Object.values(scores).reduce((a,b)=>a+b,0);
      return { scores, contrib, total };
    }

    function pickWinner({ scores, contrib }){
      const entries = personaOrder.map(p => ({ p, score: scores[p] }));
      entries.sort((a,b)=> b.score - a.score);

      const topScore = entries[0].score;
      const tied = entries.filter(e => e.score === topScore).map(e=>e.p);

      if(tied.length === 1){
        return { winner: tied[0], tied, reason: "max" };
      }

      const qBudget = 13;
      const qStyle = 7;

      const pickByContribution = (qId, candidates) => {
        const c = candidates.map(p => ({ p, c: (contrib[qId] && contrib[qId][p]) ? contrib[qId][p] : 0 }));
        c.sort((a,b)=> b.c - a.c);
        const maxC = c[0].c;
        const best = c.filter(x => x.c === maxC).map(x=>x.p);
        return { best, maxC };
      };

      const b1 = pickByContribution(qBudget, tied);
      if(b1.best.length === 1 && b1.maxC > 0){
        return { winner: b1.best[0], tied, reason: "tie_budget" };
      }

      const b2 = pickByContribution(qStyle, (b1.best.length ? b1.best : tied));
      if(b2.best.length === 1 && b2.maxC > 0){
        return { winner: b2.best[0], tied, reason: "tie_style" };
      }

      const fallback = personaOrder.find(p => tied.includes(p)) || tied[0];
      return { winner: fallback, tied, reason: "tie_fallback" };
    }

    function calcHybrid({ scores, total }){
      const entries = personaOrder.map(p => ({ p, score: scores[p] })).sort((a,b)=> b.score - a.score);
      const top1 = entries[0];
      const top2 = entries[1] || { p: top1.p, score: 0 };

      const topShare = total > 0 ? (top1.score / total) : 0;
      const isDominant = topShare >= 0.30;

      return {
        isDominant,
        top1,
        top2,
        topShare,
        top2Share: total > 0 ? (top2.score / total) : 0
      };
    }

    function petTriggered(){
      const ans = state.answers[4];
      return Array.isArray(ans) && ans.includes(2);
    }

    function childrenAndPetRisk(){
      const ans = state.answers[4];
      return Array.isArray(ans) && ans.includes(1) && ans.includes(2);
    }

    function formatPct(x){ return (x*100).toFixed(0) + "%"; }

    function resultPackage(){
      const { scores, contrib, total } = calcScores();
      const { winner, tied, reason } = pickWinner({ scores, contrib });
      const hybrid = calcHybrid({ scores, total });

      const list = personaOrder
        .map(p => ({ p, score: scores[p], share: total>0 ? scores[p]/total : 0 }))
        .sort((a,b)=> b.score - a.score);

      return { scores, total, winner, tied, reason, hybrid, list };
    }

    function buildSummaryText(res){
      if(!res.hybrid.isDominant){
        return `Hibrit profil: ${personas[res.hybrid.top1.p].title} (${formatPct(res.hybrid.topShare)}) + ${personas[res.hybrid.top2.p].title} (${formatPct(res.hybrid.top2Share)})`;
      }
      return `Kazanan profil: ${personas[res.winner].title} (${formatPct(res.hybrid.topShare)})`;
    }

    function copyToClipboard(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        return navigator.clipboard.writeText(text);
      }
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      return Promise.resolve();
    }

    function render(){
      updateSessionPill();
      updateSideSummary();

      const main = el("#mainCard");
      if(state.step === "start"){
        main.innerHTML = renderStart();
        bindStart();
        return;
      }
      if(state.step === "quiz"){
        main.innerHTML = renderQuiz();
        bindQuiz();
        return;
      }
      if(state.step === "loading"){
        main.innerHTML = renderLoading();
        return;
      }
      if(state.step === "result"){
        main.innerHTML = renderResult();
        bindResult();
        return;
      }
      state.step = "start";
      save();
      main.innerHTML = renderStart();
      bindStart();
    }

    function renderStart(){
      const prog = totalProgress();
      const hasSaved = prog.answeredCount > 0;
      return `
        <div class="screen">
          <div class="cardHeader">
            <div>
              <h2>G√∂r√º≈üme Bilgisi</h2>
              <div class="sub">Opsiyonel alanlar. ƒ∞stersen bo≈ü ge√ß.</div>
            </div>
            <div class="toggleRow">
              ${hasSaved ? `<span class="badge"><strong>Kayƒ±t:</strong> Devam edilebilir</span>` : `<span class="badge"><strong>Kayƒ±t:</strong> Yeni</span>`}
            </div>
          </div>

          <div class="cardBody">
            <div class="stack">
              <div class="fieldRow">
                <label>
                  M√º≈üteri Ad Soyad
                  <input type="text" id="metaName" placeholder="√ñrn: Ay≈üe Yƒ±lmaz" value="${escapeHtml(state.meta.name)}" />
                </label>
                <label>
                  Telefon
                  <input type="tel" id="metaPhone" placeholder="√ñrn: 05xx xxx xx xx" value="${escapeHtml(state.meta.phone)}" />
                </label>
              </div>

              <div class="fieldRow">
                <label>
                  E-posta
                  <input type="email" id="metaEmail" placeholder="√ñrn: ayse@mail.com" value="${escapeHtml(state.meta.email)}" />
                </label>
                <label>
                  ƒ∞√ß Not (Kƒ±sa)
                  <input type="text" id="metaQuick" placeholder="√ñrn: Ada istiyor, teslim acil" value="" />
                </label>
              </div>

              <label>
                Proje Notu
                <textarea id="metaNote" placeholder="Kƒ±sa notlar, beklenti, kritik detaylar...">${escapeHtml(state.meta.note)}</textarea>
                <div class="hint">Notlar sadece bu cihazda saklanƒ±r.</div>
              </label>

              <div class="navRow">
                <div class="left">
                  <button class="btn ghost" id="btnContinue" ${hasSaved ? "" : "disabled"}>Devam Et</button>
                  <button class="btn" id="btnStartNew">Ankete Ba≈üla</button>
                </div>
                <div class="right">
                  <button class="btn danger" id="btnClearSaved">Kaydƒ± Sil</button>
                </div>
              </div>

              <div class="mini">
                ƒ∞pucu: Kayƒ±t varsa <span class="kbd">Devam Et</span> kaldƒ±ƒüƒ±n soruya gider. Yoksa 1. sorudan ba≈ülar.
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderQuiz(){
      const q = currentQuestion();
      const prog = totalProgress();
      const pct = Math.round(((state.qIndex) / (questions.length - 1)) * 100);
      const answered = isAnswered(q);

      const selected = state.answers[q.id];
      const optionHtml = q.options.map((o, idx) => {
        const isSel = q.type === "single"
          ? selected === idx
          : (Array.isArray(selected) && selected.includes(idx));

        const cls = ["opt", q.type === "multi" ? "multi" : "", isSel ? "sel" : ""].join(" ").trim();
        return `
          <div class="${cls}" data-opt="${idx}" role="button" tabindex="0" aria-pressed="${isSel}">
            <div>
              <div class="t">${escapeHtml(o.text)}</div>
              <div class="tag">${q.type === "multi" ? "√áoklu se√ßim" : "Tek se√ßim"}</div>
            </div>
            <div class="mark" aria-hidden="true"></div>
          </div>
        `;
      }).join("");

      const canNext = answered;
      const isLast = state.qIndex === questions.length - 1;

      return `
        <div class="screen">
          <div class="progressWrap">
            <div class="progressLeft">
              <div class="qMeta">Soru ${state.qIndex + 1} / ${questions.length} ‚Ä¢ Cevaplanan: ${prog.answeredCount}/${prog.total}</div>
              <p class="qText">${escapeHtml(q.text)}</p>
            </div>
            <div class="bar" aria-label="ƒ∞lerleme">
              <div style="width:${pct}%"></div>
            </div>
          </div>

          <div class="cardBody">
            <div class="options" id="optList">${optionHtml}</div>

            <div class="navRow">
              <div class="left">
                <button class="btn ghost" id="btnBack" ${state.qIndex === 0 ? "disabled" : ""}>Geri</button>
                <button class="btn ${isLast ? "primary" : ""}" id="btnNext" ${canNext ? "" : "disabled"}>
                  ${isLast ? "Sonucu G√∂r" : "ƒ∞leri"}
                </button>
              </div>
              <div class="right">
                <button class="btn ghost" id="btnJumpStart">Ba≈ülangƒ±√ß</button>
                <button class="btn danger" id="btnClearAnswers">Cevaplarƒ± Temizle</button>
              </div>
            </div>

            <div class="mini">
              ${q.type === "multi" ? "Birden fazla se√ßenek i≈üaretleyebilirsin. ƒ∞leri i√ßin en az bir se√ßim ≈üart." : "ƒ∞leri i√ßin se√ßim ≈üart."}
            </div>
          </div>
        </div>
      `;
    }

    function renderLoading(){
      return `
        <div class="screen">
          <div class="cardHeader">
            <div>
              <h2>Sonu√ß Hazƒ±rlanƒ±yor</h2>
              <div class="sub">Ki≈üiselle≈ütirme tamamlanmak √ºzere.</div>
            </div>
          </div>
          <div class="cardBody loadingWrap">
            <div class="loadingCard">
              <div class="spinner" aria-hidden="true"></div>
              <div>
                <div><strong>Katalog taranƒ±yor...</strong></div>
                <div class="hint">Aksesuarlar e≈üle≈ütiriliyor...</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderResult(){
      const res = resultPackage();
      const winner = personas[res.winner];
      const heroUrl = winner.heroImage ? winner.heroImage : buildHeroUrl(winner.imageQuery);
      
      const colors = winner.colors.map(c => `
        <div class="swatch">
          <span class="swatchDot" style="background:${swatchColor(c.name)};"></span>
          ${escapeHtml(c.name)} <span style="opacity:0.5; font-size:11px; margin-left:4px;">(${escapeHtml(c.code)})</span>
        </div>
      `).join("");
      
      const accessories = winner.accessories.map((item, i) => {
        const keywords = ["kitchen,detail", "kitchen,drawer", "kitchen,light", "kitchen,accessory"][i % 4];
        const imgUrl = `https://source.unsplash.com/300x200/?${keywords}&sig=${i}`;
        return `
          <div class="accCard">
            <img src="${imgUrl}" class="accImg" loading="lazy" alt="Accessory" />
            <div class="accText">${escapeHtml(item)}</div>
          </div>
        `;
      }).join("");

      return `
        <div class="screen dashboard-grid">
          <div class="dashboard-hero">
            <div class="hero-content">
              <div>
                <div class="pill" style="margin-bottom: 12px; border-color: var(--primary); color: var(--primary);">
                  <strong>Uyum Skoru:</strong> ${formatPct(res.hybrid.topShare)}
                </div>
                <h2>${escapeHtml(winner.title)}</h2>
                <p class="hero-desc">${escapeHtml(winner.description)}</p>
                
                <div class="arch-note">
                  ‚Äú${escapeHtml(winner.architectNote)}‚Äù
                </div>
              </div>
              <div class="ctaRow" style="margin-top: 10px;">
                <a class="btn primary" href="https://example.com/randevu" target="_blank" rel="noopener noreferrer">Bu Mutfaƒüƒ± Tasarla</a>
              </div>
            </div>
            <div class="hero-img">
              <img src="${escapeHtml(heroUrl)}" alt="${escapeHtml(winner.title)} mood" loading="lazy" />
            </div>
          </div>

          <div class="dash-panel" style="grid-row: span 2;">
            <h3>Sizin ƒ∞√ßin Se√ßilen Model</h3>
            <div style="font-size: 24px; font-weight: 700; color: var(--text); margin-bottom: 8px;">
              ${escapeHtml(winner.recommendedModel)}
            </div>
            
            <div class="layout-sugg">
              <span style="font-size:18px;">üìê</span>
              <span>${escapeHtml(winner.layoutSuggestion)}</span>
            </div>

            <div class="mat-info">
              <div class="mat-title">Malzeme & Teknoloji</div>
              <div class="mat-desc"><strong>${escapeHtml(winner.materialTech)}</strong></div>
              <div class="mat-desc" style="margin-top:4px;">${escapeHtml(winner.materialDesc)}</div>
              <div class="warranty-badge">üõ°Ô∏è ${escapeHtml(winner.warrantyInfo)}</div>
            </div>
            
            <div style="margin-top: auto; padding-top: 24px;">
               <div class="navRow" style="margin-top:0; padding-top:20px; border-top:1px solid var(--border);">
                <div style="display:flex; flex-direction:column; gap:10px; width:100%;">
                  <button class="btn ghost" id="btnBackToQuiz" style="justify-content: flex-start;">‚Üê Ankete D√∂n</button>
                  <button class="btn ghost" id="btnPrint" style="justify-content: flex-start;">üñ®Ô∏è Yazdƒ±r</button>
                  <button class="btn danger" id="btnNewFromResult" style="justify-content: flex-start; border-color:var(--border);">Yeni G√∂r√º≈üme</button>
                </div>
              </div>
            </div>
          </div>

          <div class="dash-panel">
            <h3>Renk Paleti</h3>
            <div class="swatchGrid">${colors}</div>
          </div>

          <div class="dash-panel">
            <h3>Size √ñzel Aksesuarlar</h3>
            <div class="accGrid">${accessories}</div>
          </div>
        </div>
      `;
    }

    function updateSessionPill(){
      const prog = totalProgress();
      el("#sessionState").textContent = (prog.answeredCount > 0) ? `Devam (${prog.answeredCount}/${prog.total})` : "Yeni";
    }

    function updateSideSummary(){
      const side = el("#sideSummary");
      if(!side) return;

      const prog = totalProgress();

      if(state.step === "result"){
        side.textContent = buildSummaryText(resultPackage());
        return;
      }

      if(prog.answeredCount === 0){
        side.textContent = "Ba≈ülamak i√ßin g√∂r√º≈üme bilgisi gir veya direkt ankete ba≈üla.";
        return;
      }

      const q = questions[state.qIndex] || questions[0];
      side.textContent = `ƒ∞lerleme: ${prog.answeredCount}/${prog.total}. ≈ûu an: Soru ${state.qIndex+1}. ${isAnswered(q) ? "Se√ßildi." : "Se√ßim bekliyor."}`;
    }

    function bindStart(){
      const name = el("#metaName");
      const phone = el("#metaPhone");
      const email = el("#metaEmail");
      const note = el("#metaNote");
      const quick = el("#metaQuick");

      const sync = () => {
        state.meta.name = name.value.trim();
        state.meta.phone = phone.value.trim();
        state.meta.email = email.value.trim();
        state.meta.note = note.value.trim();
        save();
      };

      [name,phone,email,note].forEach(x => x.addEventListener("input", sync));

      if(quick){
        quick.addEventListener("keydown", (e)=>{
          if(e.key === "Enter"){
            e.preventDefault();
            const v = quick.value.trim();
            if(v){
              state.meta.note = (state.meta.note ? (state.meta.note + "\n") : "") + v;
              quick.value = "";
              save();
              render();
            }
          }
        });
      }

      const prog = totalProgress();
      el("#btnContinue").addEventListener("click", ()=>{
        if(prog.answeredCount === 0) return;
        startQuiz();
      });

      el("#btnStartNew").addEventListener("click", ()=>{
        state.qIndex = 0;
        state.step = "quiz";
        save();
        render();
      });

      el("#btnClearSaved").addEventListener("click", ()=>{
        clearStorage();
        resetAll({ keepMeta:false });
      });
    }

    function bindQuiz(){
      const q = currentQuestion();
      const optList = el("#optList");
      els(".opt", optList).forEach(node => {
        node.addEventListener("click", () => selectOption(q, Number(node.dataset.opt)));
        node.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            selectOption(q, Number(node.dataset.opt));
          }
        });
      });

      el("#btnBack").addEventListener("click", ()=>{
        if(state.qIndex <= 0) return;
        state.qIndex -= 1;
        save();
        render();
      });

      el("#btnNext").addEventListener("click", ()=>{
        if(!isAnswered(q)) return;
        if(state.qIndex >= questions.length - 1){
          startLoadingResult();
          return;
        }
        state.qIndex += 1;
        save();
        render();
      });

      el("#btnJumpStart").addEventListener("click", ()=>{
        state.step = "start";
        save();
        render();
      });

      el("#btnClearAnswers").addEventListener("click", ()=>{
        state.answers = {};
        state.qIndex = 0;
        save();
        render();
      });
    }

    function bindResult(){
      el("#btnBackToQuiz").addEventListener("click", ()=>{
        state.step = "quiz";
        state.qIndex = questions.length - 1;
        save();
        render();
      });

      el("#btnNewFromResult").addEventListener("click", ()=> resetAll({ keepMeta:true }));

      el("#btnPrint").addEventListener("click", ()=> window.print());
    }

    function flashPill(msg){
      const pill = el("#sessionPill");
      const old = el("#sessionState").textContent;
      el("#sessionState").textContent = msg;
      pill.style.borderColor = "rgba(140,200,255,.42)";
      pill.style.background = "rgba(140,200,255,.16)";
      setTimeout(()=>{
        pill.style.borderColor = "";
        pill.style.background = "";
        el("#sessionState").textContent = old;
      }, 900);
    }

    el("#btnNew").addEventListener("click", ()=> resetAll({ keepMeta:true }));
    el("#btnReset").addEventListener("click", ()=> resetAll({ keepMeta:false }));

    window.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        e.preventDefault();
        resetAll({ keepMeta:true });
        return;
      }
      if(state.step !== "quiz") return;
      if(e.key === "ArrowLeft"){
        e.preventDefault();
        const b = el("#btnBack");
        if(b && !b.disabled) b.click();
      }
      if(e.key === "ArrowRight"){
        e.preventDefault();
        const n = el("#btnNext");
        if(n && !n.disabled) n.click();
      }
    });

    function unique(arr){
      const s = new Set();
      const out = [];
      for(const x of arr){
        if(!s.has(x)){ s.add(x); out.push(x); }
      }
      return out;
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function buildHeroUrl(query){
      return `https://source.unsplash.com/1600x900/?${encodeURIComponent(query)}`;
    }

    function swatchColor(label){
      let hash = 0;
      for(let i = 0; i < label.length; i++){
        hash = label.charCodeAt(i) + ((hash << 5) - hash);
        hash |= 0;
      }
      const hue = Math.abs(hash) % 360;
      return `hsl(${hue} 36% 70%)`;
    }

    const hasLoaded = load();
    if(!hasLoaded) save();

    if(state.step === "quiz" && (state.qIndex == null || isNaN(state.qIndex))) state.qIndex = 0;
    if(state.step === "result" && totalProgress().answeredCount === 0) state.step = "start";
    if(state.step === "loading") state.step = "result";

    render();
  </script>
</body>
</html>
