<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>İntema Mutfak Dijital Mimar Asistanı</title>
  <style>
    :root{
      --bg0:#f7f9fc;
      --bg1:#eef3f9;
      --card: rgba(255,255,255,.82);
      --card2: rgba(255,255,255,.94);
      --stroke: rgba(15,32,56,.08);
      --stroke2: rgba(15,32,56,.12);
      --text:#1a2433;
      --muted: rgba(26,36,51,.7);
      --muted2: rgba(26,36,51,.48);
      --good: rgba(114,210,170,.2);
      --warn: rgba(255,200,140,.2);
      --bad: rgba(255,140,140,.2);
      --shadow: 0 24px 60px rgba(21,40,70,.12);
      --shadow-soft: 0 18px 50px rgba(17,32,58,.12);
      --shadow-lite: 0 10px 26px rgba(17,32,58,.08);
      --glow: radial-gradient(120% 120% at 15% 10%, rgba(255,255,255,.9), rgba(255,255,255,0) 58%);
      --r: 18px;
      --r2: 14px;
      --pad: 18px;
      --btn: rgba(255,255,255,.85);
      --btn2: rgba(255,255,255,1);
      --focus: rgba(120,170,255,.24);
      --maxw: 100%;
      --tap: 52px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(255,255,255,.9), transparent 55%),
        radial-gradient(900px 540px at 80% 0%, rgba(190,220,255,.45), transparent 60%),
        radial-gradient(900px 560px at 70% 95%, rgba(255,225,190,.42), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px 14px 28px;
    }

    header{
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      padding: 8px 4px 14px;
    }

    .brand{
      display:flex; flex-direction:column; gap:4px;
    }
    .brand .kicker{
      font-size:12px;
      color: var(--muted2);
      letter-spacing:.12em;
      text-transform: uppercase;
    }
    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing: .2px;
      line-height:1.25;
      font-weight: 650;
    }
    .brand p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      max-width: 68ch;
    }

    .topActions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.75);
      border: 1px solid var(--stroke);
      color: var(--muted);
      font-size: 12px;
      user-select:none;
    }
    .pill strong{ color: var(--text); font-weight:650; }

    .btn{
      height: var(--tap);
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke2);
      background: var(--btn);
      color: var(--text);
      font-size: 14px;
      font-weight: 650;
      letter-spacing:.1px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      box-shadow: 0 14px 30px rgba(18,34,60,.12);
      touch-action: manipulation;
    }
    .btn:active{ transform: translateY(1px) scale(.995); }
    .btn:hover{ background: var(--btn2); border-color: rgba(255,255,255,.18); }
    .btn:focus{ outline:none; box-shadow: 0 0 0 4px var(--focus); }
    .btn.ghost{
      background: transparent;
      box-shadow:none;
    }
    .btn.primary{
      background: rgba(160,205,255,.4);
      border-color: rgba(120,170,255,.45);
    }
    .btn.primary:hover{
      background: rgba(160,205,255,.52);
      border-color: rgba(120,170,255,.6);
    }
    .btn.danger{
      background: rgba(255,160,160,.24);
      border-color: rgba(255,160,160,.4);
    }

    @media (max-width: 920px){
      header{ align-items:flex-start; }
      .topActions{ justify-content:flex-start; }
    }

    .card{
      background:
        var(--glow),
        linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.86));
      border: 1px solid var(--stroke);
      border-radius: calc(var(--r) + 2px);
      box-shadow: var(--shadow-soft);
      overflow:hidden;
    }
    .cardHeader{
      padding: 14px var(--pad);
      border-bottom: 1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .cardHeader h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
      font-weight: 700;
    }
    .cardHeader .sub{
      margin:0;
      color: var(--muted2);
      font-size: 12px;
      margin-top:2px;
    }
    .cardBody{ padding: var(--pad); }

    .stack{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .fieldRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 560px){
      .fieldRow{ grid-template-columns: 1fr; }
    }

    label{
      display:flex;
      flex-direction:column;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
    }

    input[type="text"], input[type="tel"], input[type="email"], textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.85);
      color: var(--text);
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    textarea{ min-height: 92px; resize: vertical; }
    input:focus, textarea:focus{
      box-shadow: 0 0 0 4px var(--focus);
      border-color: rgba(140,200,255,.45);
    }
    .hint{
      color: var(--muted2);
      font-size: 12px;
      line-height:1.35;
      margin-top: 2px;
    }

    .progressWrap{
      padding: 12px var(--pad);
      border-bottom: 1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .progressLeft{
      display:flex;
      flex-direction:column;
      gap: 3px;
    }
    .qMeta{
      color: var(--muted2);
      font-size: 12px;
      letter-spacing:.2px;
    }
    .qText{
      font-size: 18px;
      font-weight: 720;
      margin:0;
      line-height:1.2;
      letter-spacing:.1px;
    }
    .bar{
      width: 260px;
      height: 10px;
      border-radius: 999px;
      background: rgba(15,32,56,.06);
      border: 1px solid var(--stroke);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: rgba(120,170,255,.45);
      border-right: 1px solid rgba(120,170,255,.6);
      transition: width .18s ease;
    }
    @media (max-width: 560px){
      .bar{ width: 160px; }
      .qText{ font-size: 16px; }
    }

    .options{
      display:grid;
      gap: 10px;
      margin-top: 14px;
    }
    .opt{
      border-radius: 16px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.8);
      padding: 14px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      cursor:pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      user-select:none;
      min-height: 56px;
    }
    .opt:hover{ background: rgba(255,255,255,.95); border-color: rgba(120,170,255,.35); }
    .opt:active{ transform: translateY(1px); }
    .opt.sel{
      background: rgba(160,205,255,.35);
      border-color: rgba(120,170,255,.5);
    }
    .opt .t{
      font-size: 15px;
      font-weight: 650;
      line-height:1.25;
    }
    .opt .tag{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted2);
    }
    .opt .mark{
      width: 18px; height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(80,110,150,.3);
      background: rgba(255,255,255,.7);
      margin-top: 2px;
      flex: 0 0 auto;
      position:relative;
    }
    .opt.sel .mark{
      border-color: rgba(120,170,255,.6);
      background: rgba(160,205,255,.4);
    }
    .opt.sel .mark::after{
      content:"";
      position:absolute; inset: 4px;
      border-radius:999px;
      background: rgba(140,200,255,.75);
    }
    .opt.multi .mark{ border-radius: 6px; }
    .opt.multi.sel .mark::after{ border-radius: 4px; }

    .navRow{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      margin-top: 14px;
      flex-wrap:wrap;
    }
    .navRow .left, .navRow .right{
      display:flex; gap:10px; flex-wrap:wrap;
    }

    .mini{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 8px;
      line-height:1.35;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      color: var(--muted);
      font-size: 12px;
      user-select:none;
    }
    .badge strong{ color: var(--text); font-weight: 750; }
    .split{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 14px var(--pad);
    }
    .split.bento{
      grid-template-columns: repeat(12, minmax(0, 1fr));
      gap: 14px;
    }

    .panel{
      border-radius: calc(var(--r2) + 2px);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.9);
      padding: 12px 12px;
      box-shadow: var(--shadow-lite);
      position: relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:0;
      background: var(--glow);
      opacity:.7;
      pointer-events:none;
    }
    .panel > *{
      position:relative;
      z-index:1;
    }

    .bento-card{
      backdrop-filter: blur(6px);
    }
    .bento-meta{ grid-column: span 7; }
    .bento-recipe{ grid-column: span 5; }
    .bento-alert,
    .bento-pet{ grid-column: span 6; }
    .bento-scores{ grid-column: span 5; }
    .bento-note{ grid-column: span 7; }

    @media (max-width: 980px){
      .split.bento{ grid-template-columns: repeat(8, minmax(0, 1fr)); }
      .bento-meta,
      .bento-recipe,
      .bento-alert,
      .bento-pet,
      .bento-scores,
      .bento-note{ grid-column: span 8; }
    }
    @media (max-width: 640px){
      .split.bento{ grid-template-columns: 1fr; }
      .bento-meta,
      .bento-recipe,
      .bento-alert,
      .bento-pet,
      .bento-scores,
      .bento-note{ grid-column: auto; }
    }

    .panel h3{
      margin:0 0 8px 0;
      font-size: 13px;
      font-weight: 780;
      letter-spacing:.2px;
    }
    .panel ul{
      margin:0;
      padding-left: 18px;
      color: var(--muted);
      line-height:1.45;
      font-size: 13px;
    }
    .panel p{
      margin:0;
      color: var(--muted);
      line-height:1.45;
      font-size: 13px;
    }

    .mediaGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
    }
    .mediaCard{
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.9);
      overflow:hidden;
      box-shadow: var(--shadow-lite);
    }
    .mediaCard img{
      display:block;
      width:100%;
      height: 140px;
      object-fit: cover;
    }
    .mediaCard .label{
      padding: 8px 10px 10px;
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
    }

    .alert{
      background:
        var(--glow),
        var(--warn);
      border-color: rgba(255,190,120,.32);
    }
    .ok{
      background:
        var(--glow),
        var(--good);
      border-color: rgba(120,255,180,.28);
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.85);
    }
    th, td{
      text-align:left;
      padding: 10px 10px;
      border-bottom: 1px solid var(--stroke);
      font-size: 12px;
      color: var(--muted);
    }
    th{
      color: var(--muted2);
      font-weight: 800;
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 11px;
      background: rgba(15,32,56,.04);
    }
    tr:last-child td{ border-bottom: 0; }
    td strong{ color: var(--text); font-weight: 750; }

    .hide{ display:none !important; }

    .footerNote{
      color: var(--muted2);
      font-size: 12px;
      line-height:1.45;
      padding: 10px 4px 0;
    }

    .kbd{
      padding: 3px 7px;
      border-radius: 9px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.9);
      color: var(--muted);
      font-weight: 750;
      font-size: 11px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="kicker">Sales Point Tablet App</div>
        <h1>İntema Mutfak Dijital Mimar Asistanı</h1>
        <p>14 soruluk akış. 10 arketip skoru. Sonuç ekranında reçete ve hibrit profil öne çıkar.</p>
      </div>
      <div class="topActions">
        <div class="pill" id="sessionPill"><strong>Oturum:</strong> <span id="sessionState">Yeni</span></div>
        <button class="btn ghost" id="btnNew">Yeni Görüşme</button>
        <button class="btn danger" id="btnReset">Sıfırla</button>
      </div>
    </header>

    <div class="card" id="mainCard"></div>

    <div class="footerNote">
      Bu uygulama tek dosya çalışır. Veri sadece bu cihazın tarayıcısında saklanır (LocalStorage).
    </div>
  </div>

  <script>
    // --- REVİZE EDİLMİŞ DENGELİ SORU HAVUZU (MAX PUAN ~100 EŞİTLENDİ) ---
    const questions = [
      {
        id: 1, text: "Bu mutfak projesinin niteliği nedir?", type: "single",
        options: [
          { text: "Kendi evim / Tadilat", scores: { p3: 5, p10: 5 } },
          { text: "Yeni Ev / Sıfır Proje", scores: { p1: 10, p2: 10, p7: 5 } },
          { text: "Yatırım / Stüdyo / Kiraya verilecek", scores: { p4: 30 } },
          { text: "Yazlık / İkinci Ev", scores: { p8: 40 } }
        ]
      },
      {
        id: 2, text: "Zaman kısıtınız nedir?", type: "single",
        options: [
          { text: "Çok acil, hemen bitmeli", scores: { p9: 40, p4: 10 } },
          { text: "Standart süreç (1-2 ay)", scores: { p3: 5, p5: 5 } },
          { text: "Zaman sorun değil, mükemmel olsun", scores: { p2: 15, p10: 15, p6: 10 } }
        ]
      },
      {
        id: 3, text: "Mutfak alanının durumu?", type: "single",
        options: [
          { text: "Dar / Küçük", scores: { p4: 15, p9: 10 } },
          { text: "Geniş / Ada Müsait", scores: { p7: 25, p5: 15, p2: 10 } },
          { text: "Standart", scores: { p3: 5 } }
        ]
      },
      {
        id: 4, text: "Hane Halkı (Birden fazla seçebilirsiniz)", type: "multi",
        options: [
          { text: "Yalnız / Çift", scores: { p1: 15, p4: 10, p5: 5 } },
          { text: "Çocuklar Var", scores: { p3: 20 } },
          { text: "Evcil Hayvan Var", scores: { p6: 15, p3: 10 } },
          { text: "Kalabalık Aile", scores: { p7: 15, p10: 10, p3: 10 } }
        ]
      },
      {
        id: 5, text: "Mutfak sizin için ne ifade ediyor?", type: "single",
        options: [
          { text: "Vitrin (Sosyal Alan)", scores: { p7: 30, p1: 10, p2: 10 } },
          { text: "Operasyon (Yemek Yapma)", scores: { p5: 35 } },
          { text: "Sığınak (Huzur)", scores: { p8: 25, p6: 20 } },
          { text: "Kalp (Aile Odaklı)", scores: { p10: 25, p3: 10 } },
          { text: "İstasyon (Pratik)", scores: { p9: 20, p4: 15 } }
        ]
      },
      {
        id: 6, text: "Şu anki mutfakta en büyük şikayetiniz?", type: "single",
        options: [
          { text: "Dağınıklık / Yer yok", scores: { p5: 15, p3: 5, p4: 5 } },
          { text: "Temizlik Zorluğu / Lekeler", scores: { p3: 15, p9: 10 } },
          { text: "Demode Görünüm", scores: { p1: 15, p2: 10, p7: 5 } },
          { text: "Karanlık / Basık", scores: { p8: 20, p6: 10 } }
        ]
      },
      {
        id: 7, text: "Hangi tasarım dili size yakın?", type: "single",
        options: [
          { text: "Modern & Minimal", scores: { p1: 20, p5: 10, p4: 5 } },
          { text: "Klasik & Gösterişli", scores: { p2: 30, p10: 10 } },
          { text: "Country & Doğal", scores: { p10: 30, p6: 20, p8: 15 } },
          { text: "Endüstriyel", scores: { p1: 15, p5: 15, p7: 10 } }
        ]
      },
      {
        id: 8, text: "Malzeme ve Doku tercihiniz?", type: "single",
        options: [
          { text: "Doğal Ahşap Dokusu", scores: { p6: 25, p10: 15, p8: 10 } },
          { text: "Mat ve Soft Renkler", scores: { p3: 15, p8: 15, p1: 5 } },
          { text: "Parlak ve Canlı", scores: { p2: 25, p7: 15 } },
          { text: "Koyu ve Maskülen", scores: { p1: 20, p5: 10 } }
        ]
      },
      {
        id: 9, text: "Yemek pişirme alışkanlığınız?", type: "single",
        options: [
          { text: "Standart Pişirme", scores: { p3: 10, p10: 5 } },
          { text: "Gurme / Profesyonel", scores: { p5: 40 } },
          { text: "Minimum / Pratik", scores: { p9: 20, p4: 15, p1: 5 } }
        ]
      },
      {
        id: 10, text: "Depolama ihtiyacınız?", type: "single",
        options: [
          { text: "Maksimum Kiler / Stok", scores: { p3: 15, p5: 15 } },
          { text: "Vitrin / Sergileme", scores: { p7: 20, p2: 15, p10: 10 } },
          { text: "Standart / Kapalı Dolap", scores: { p4: 10, p1: 5 } }
        ]
      },
      {
        id: 11, text: "Sürdürülebilirlik önceliğiniz?", type: "single",
        options: [
          { text: "Çok Önemli / Vazgeçilmez", scores: { p6: 40 } },
          { text: "Önemli ama estetik de önemli", scores: { p6: 15, p8: 10, p3: 5 } },
          { text: "Öncelik Değil", scores: { p4: 5, p9: 5 } }
        ]
      },
      {
        id: 12, text: "Teknoloji entegrasyonu?", type: "single",
        options: [
          { text: "High-Tech (Akıllı sistemler)", scores: { p1: 30, p5: 5 } },
          { text: "Geleneksel / Manuel", scores: { p10: 25, p6: 10, p8: 5 } }
        ]
      },
      {
        id: 13, text: "Bütçe yaklaşımınız?", type: "single",
        options: [
          { text: "Esnek / Prestij Odaklı", scores: { p2: 30, p1: 10, p7: 10 } },
          { text: "Fiyat / Performans", scores: { p3: 20, p5: 10, p10: 5 } },
          { text: "Ekonomik / Bütçe Dostu", scores: { p4: 25, p9: 15 } }
        ]
      },
      {
        id: 14, text: "Karar verme faktörünüz?", type: "single",
        options: [
          { text: "Tasarım Heyecanı", scores: { p1: 10, p2: 5, p7: 5 } },
          { text: "Güven / Garanti", scores: { p3: 15, p10: 5 } },
          { text: "Hız / Teslimat", scores: { p9: 30 } },
          { text: "Maliyet", scores: { p4: 15 } }
        ]
      }
    ];

    // Persona verisi: sonuç ekranındaki aksesuar, renk, malzeme önerileri buradan gelir
    const personasList = [
      {
        id: "p1",
        title: "Şehirli Vizyoner",
        headline: "Mutfak Senin İçin Bir Vitrin.",
        summary: "Trendleri takip ediyor, teknolojiyi ve modernizmi seviyorsun. Net çizgiler ve çağdaş detaylarla yaşayan, şık bir alan istiyorsun.",
        model: "INOVA",
        material: "Mat Lake / Metal Görünümlü",
        color: "Renk: M104_Grafit / T112_Koyu Taupe / M007_Siyah",
        modelImage: "https://images.unsplash.com/photo-1502005097973-6a7082348e28?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1506368249639-73a05d6f6488?auto=format&fit=crop&w=900&q=80",
        features: [
          "Kulpsuz Tasarım (Gola Profil)",
          "Ring Aydınlatma Ünitesi",
          "USB Şarjlı Modüller"
        ],
        architectNote: "Grafit ve koyu taupe renklerini metal görünümle eşleştirip modern ve minimal çizgiyi vurgulayın."
      },
      {
        id: "p2",
        title: "Klasik Lüks Sever",
        headline: "Zamansız Kalite ve Prestij.",
        summary: "Kalite asla modası geçmeyen bir yatırımdır. Geleneksel çizgilerin ağırbaşlılığını ve işçilik detaylarını arıyorsun.",
        model: "TOSCANA",
        material: "Parlak Lake / Mat Lake",
        color: "Renk: P019_Orman Yeşili / P020_Uzay Mavi / P017_İnci Beyaz",
        modelImage: "https://images.unsplash.com/photo-1505691938895-1758d7feb511?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1523413651479-597eb2da0ad6?auto=format&fit=crop&w=900&q=80",
        features: [
          "Çerçeveli Kapaklar",
          "Büfe Tipi Camlı Üst Dolaplar",
          "Gold/Pirinç Kulplar (MKGDK33FP0032)"
        ],
        architectNote: "Toscana'nın çerçeve işçiliğini ve orman yeşili renginin derinliğini numune üzerinde gösterin."
      },
      {
        id: "p3",
        title: "Konfor Odaklı Aile",
        headline: "Dayanıklılık ve Kolaylık Önceliğin.",
        summary: "Mutfak evin kalbidir. Dayanıklılık, temizlik kolaylığı ve bolca saklama alanı senin için her şeyden önemli.",
        model: "SIENA",
        material: "Akrilik PET / Mat PET",
        color: "Renk: T125_Manolya / T123_Kaşmir / T122_Açık Gri",
        modelImage: "https://images.unsplash.com/photo-1481278403982-f2d9f387cdcc?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1481931715705-36f5f79f1f3d?auto=format&fit=crop&w=900&q=80",
        features: [
          "Parmak İzi Bırakmayan Yüzey",
          "Boy Kiler Mekanizması (Dispensa)",
          "Evcil Hayvan Modülü"
        ],
        architectNote: "Mat PET ve akrilik PET yüzeylerin dayanıklılık ve temizlik kolaylığını vurgulayın."
      },
      {
        id: "p4",
        title: "Akıllı Yatırımcı (Micro-Living)",
        headline: "Akıllı Metrekareler, Yüksek Değer.",
        summary: "Pragmatiksiniz. Alan kısıtlı ama beklentiniz yüksek. Hedefiniz; bütçeyi yormadan, uzun ömürlü ve mekanı verimli kullanan bir çözüm.",
        model: "PRIME",
        material: "Melamin",
        color: "Renk: Beyaz / Kum Beji / Meşe",
        modelImage: "https://images.unsplash.com/photo-1484154218962-a197022b5858?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1481277542470-605612bd2d61?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?auto=format&fit=crop&w=900&q=80",
        features: [
          "Yerden Tasarruf Sağlayan Açılır Masa",
          "Kör Köşe Mekanizması (Le Mans)",
          "Darbe Dayanımı Yüksek Melamin Kapaklar",
          "Laminant Tezgah (Hızlı Teslimat)"
        ],
        architectNote: "Prime serisinin modüler yapısını ve Melamin malzemenin fiyat/performans avantajını anlatın."
      },
      {
        id: "p5",
        title: "Gurme Şef",
        headline: "Evinizin Profesyonel Lezzet İstasyonu.",
        summary: "Yemek yapmak sizin için bir sanat. Tezgahınız atölyeniz. İhtiyacınız olan şey estetikten öte, kusursuz bir operasyonel akış.",
        model: "INOVA (+5cm Yüksek Gövde)",
        material: "Mat Lake",
        color: "Renk: Koyu Gri / Beyaz",
        modelImage: "https://images.unsplash.com/photo-1501876725168-00c445821c9e?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1502741338009-cac2772e18bc?auto=format&fit=crop&w=900&q=80",
        features: [
          "Orgalux Ahşap Çekmece İçi Düzenleyiciler",
          "78 cm Yüksek Gövde (%20 Fazla Hacim)",
          "Sanayi Tipi Eviye ve Batarya",
          "Ergonomik (Yükseltilmiş) Bulaşık Makinesi Modülü"
        ],
        architectNote: "Müşteriyi +5cm yüksek modül yanına götürüp tezgah ergonomisi ve iç hacim farkını deneyimletin."
      },
      {
        id: "p6",
        title: "Doğal Ruh",
        headline: "Doğal Dokularla Sığınak Hissi.",
        summary: "Evin senin sığınağın. Doğal dokular, ahşap sıcaklığı ve sürdürülebilirlik önceliğin.",
        model: "NORDA",
        material: "Doğal Ahşap Kaplama / Geri Dönüştürülmüş PET",
        color: "Renk: W009_Düşey Hareli Naturel Meşe / T1_121_Adaçayı Yeşili / M023_Beton Yeşili",
        modelImage: "https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1493770348161-369560ae357d?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1472220625704-91e1462799b2?auto=format&fit=crop&w=900&q=80",
        features: [
          "Micro Garden Ünitesi (Bitki Yetiştirme)",
          "Ahşap Açık Raflar",
          "İskandinav Tasarım"
        ],
        architectNote: "Düşey hareli meşe dokusunu ve adaçayı yeşili tonlarını doğal ışıkta gösterin."
      },
      {
        id: "p7",
        title: "Sosyal Ev Sahibi",
        headline: "Sadece Yemek Değil, Sohbet Pişirilen Yer.",
        summary: "Mutfak sizin sahneniz. Dostlarınızla kadeh kaldırdığınız, yemek yaparken sohbetin kesilmediği, salonla bütünleşen bir alan.",
        model: "INOVA (Ada Planlaması)",
        material: "Kombinasyon: Mat Lake ve Doğal Kaplama",
        color: "Renk: Siyah (Ada) ve Ceviz (Dolaplar)",
        modelImage: "https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1495567720989-cebdbdd97913?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=900&q=80",
        features: [
          "Ada Çevresi Oturma Alanı (Bar)",
          "Şaraplık ve Kadehlik Modülleri",
          "Dekoratif Metal Tavan Rafları",
          "Ambiyans Aydınlatması"
        ],
        architectNote: "Ada mutfağın salona bakan yüzünde vitrin veya açık raf kullanarak geçişi nasıl yumuşatacağınızı anlatın."
      },
      {
        id: "p8",
        title: "Yazlık Ruhu",
        headline: "Sahil Evi Ferahlığı.",
        summary: "Şehirde bile olsan mutfağında bir sahil evi ferahlığı arıyorsun. Çizgili dokular ve mavi tonlar vazgeçilmezin.",
        model: "FRESCA",
        material: "Mat Lake / Mat PET",
        color: "Renk: F1_M021_Baltık Mavi / F1_M001_Buz Beyaz / T1_120_Baltık Mavi",
        modelImage: "https://images.unsplash.com/photo-1466978913421-dad2ebd01d17?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1502055887010-bba4e8f7b21b?auto=format&fit=crop&w=900&q=80",
        features: [
          "Düşey Fugalı Kapaklar",
          "Cam Önü Eviye Yerleşimi",
          "Marin Esintiler"
        ],
        architectNote: "Baltık mavi tonlarını çizgili kapak dokusuyla eşleştirip marin hissi güçlendirin."
      },
      {
        id: "p9",
        title: "Hız ve Pratiklik Odaklı",
        headline: "Hızlı ve Ekonomik Çözümler.",
        summary: "Kararını verdin, sonuç istiyorsun. Hızlı, ekonomik ama şık çözümler tam sana göre.",
        model: "PRIME",
        material: "Laminant / Düz Melamin",
        color: "Renk: M104_Grafit / M103_Latte / M101_Mat Beyaz",
        modelImage: "https://images.unsplash.com/photo-1507089947368-19c1da9775ae?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1487014679447-9f8336841d58?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1506368249639-73a05d6f6488?auto=format&fit=crop&w=900&q=80",
        features: [
          "Hızlı Teslimat",
          "Açılır Masa Mekanizmaları",
          "Kapağa Entegre Kulp"
        ],
        architectNote: "Prime serisinde hızlı teslimat avantajını net tarih vererek vurgulayın."
      },
      {
        id: "p10",
        title: "Nostaljik Romantik",
        headline: "Geçmişin Sıcaklığı, Bugünün Konforu.",
        summary: "Geçmişin sıcaklığı, bugünün konforu. 'Anne mutfağı' sıcaklığında duygusal bir yer istiyorsun.",
        model: "VEGA",
        material: "Mat Lake / Polimerik",
        color: "Renk: V1_M021_Baltık Mavi / T125_Manolya / V1_M024_Buz Gri",
        modelImage: "https://images.unsplash.com/photo-1449844908441-8829872d2607?auto=format&fit=crop&w=900&q=80",
        colorImage: "https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?auto=format&fit=crop&w=900&q=80",
        accessoryImage: "https://images.unsplash.com/photo-1481931715705-36f5f79f1f3d?auto=format&fit=crop&w=900&q=80",
        features: [
          "Kafesli Tel Dolaplar",
          "Rustik Kulplar",
          "Açık Terek Rafları"
        ],
        architectNote: "Vega'nın country hissini rustik kulplar ve kafesli tel dolaplarla güçlendirin."
      }
    ];

    const personas = Object.fromEntries(personasList.map(p => [p.id, p]));
    const personaOrder = ["p1","p2","p3","p4","p5","p6","p7","p8","p9","p10"];

    const STORAGE_KEY = "intema_mimar_asistan_v4";

    const state = {
      step: "start",
      qIndex: 0,
      answers: {},
      meta: { name:"", phone:"", email:"", note:"" }
    };

    const el = (sel, root=document) => root.querySelector(sel);
    const els = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function deepClone(o){ return JSON.parse(JSON.stringify(o)); }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(deepClone(state)));
      updateSessionPill();
      updateSideSummary();
    }

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return false;
        const payload = JSON.parse(raw);
        if(!payload || typeof payload !== "object") return false;
        Object.assign(state, payload);
        return true;
      }catch(e){
        return false;
      }
    }

    function clearStorage(){ localStorage.removeItem(STORAGE_KEY); }

    function resetAll({ keepMeta=false } = {}){
      const preserved = keepMeta ? deepClone(state.meta) : { name:"", phone:"", email:"", note:"" };
      state.step = "start";
      state.qIndex = 0;
      state.answers = {};
      state.meta = preserved;
      save();
      render();
    }

    function startQuiz(){
      state.step = "quiz";
      state.qIndex = Math.max(0, Math.min(state.qIndex || 0, questions.length - 1));
      save();
      render();
    }

    function currentQuestion(){ return questions[state.qIndex]; }

    function isAnswered(q){
      const a = state.answers[q.id];
      if(q.type === "single") return typeof a === "number";
      if(q.type === "multi") return Array.isArray(a) && a.length > 0;
      return false;
    }

    function selectOption(q, optIndex){
      if(q.type === "single"){
        state.answers[q.id] = optIndex;
      }else{
        const cur = Array.isArray(state.answers[q.id]) ? state.answers[q.id] : [];
        state.answers[q.id] = cur.includes(optIndex) ? cur.filter(i=>i!==optIndex) : [...cur, optIndex];
      }
      save();
      render();
    }

    function totalProgress(){
      const answeredCount = questions.reduce((acc,q)=>acc + (isAnswered(q)?1:0), 0);
      return { answeredCount, total: questions.length };
    }

    function calcScores(){
      const scores = {};
      const contrib = {};
      personaOrder.forEach(p => scores[p] = 0);

      for(const q of questions){
        const ans = state.answers[q.id];
        if(ans === undefined) continue;

        contrib[q.id] = {};
        personaOrder.forEach(p => contrib[q.id][p] = 0);

        if(q.type === "single"){
          const opt = q.options[ans];
          if(opt && opt.scores){
            for(const [p,val] of Object.entries(opt.scores)){
              if(scores[p] === undefined) continue;
              scores[p] += val;
              contrib[q.id][p] += val;
            }
          }
        }else if(q.type === "multi"){
          const arr = Array.isArray(ans) ? ans : [];
          for(const idx of arr){
            const opt = q.options[idx];
            if(opt && opt.scores){
              for(const [p,val] of Object.entries(opt.scores)){
                if(scores[p] === undefined) continue;
                scores[p] += val;
                contrib[q.id][p] += val;
              }
            }
          }
        }
      }

      const total = Object.values(scores).reduce((a,b)=>a+b,0);
      return { scores, contrib, total };
    }

    function pickWinner({ scores, contrib }){
      const entries = personaOrder.map(p => ({ p, score: scores[p] }));
      entries.sort((a,b)=> b.score - a.score);

      const topScore = entries[0].score;
      const tied = entries.filter(e => e.score === topScore).map(e=>e.p);

      if(tied.length === 1){
        return { winner: tied[0], tied, reason: "max" };
      }

      const qBudget = 13;
      const qStyle = 7;

      const pickByContribution = (qId, candidates) => {
        const c = candidates.map(p => ({ p, c: (contrib[qId] && contrib[qId][p]) ? contrib[qId][p] : 0 }));
        c.sort((a,b)=> b.c - a.c);
        const maxC = c[0].c;
        const best = c.filter(x => x.c === maxC).map(x=>x.p);
        return { best, maxC };
      };

      const b1 = pickByContribution(qBudget, tied);
      if(b1.best.length === 1 && b1.maxC > 0){
        return { winner: b1.best[0], tied, reason: "tie_budget" };
      }

      const b2 = pickByContribution(qStyle, (b1.best.length ? b1.best : tied));
      if(b2.best.length === 1 && b2.maxC > 0){
        return { winner: b2.best[0], tied, reason: "tie_style" };
      }

      const fallback = personaOrder.find(p => tied.includes(p)) || tied[0];
      return { winner: fallback, tied, reason: "tie_fallback" };
    }

    function calcHybrid({ scores, total }){
      const entries = personaOrder.map(p => ({ p, score: scores[p] })).sort((a,b)=> b.score - a.score);
      const top1 = entries[0];
      const top2 = entries[1] || { p: top1.p, score: 0 };

      const topShare = total > 0 ? (top1.score / total) : 0;
      const isDominant = topShare >= 0.30;

      return {
        isDominant,
        top1,
        top2,
        topShare,
        top2Share: total > 0 ? (top2.score / total) : 0
      };
    }

    function petTriggered(){
      const ans = state.answers[4];
      return Array.isArray(ans) && ans.includes(2);
    }

    function childrenAndPetRisk(){
      const ans = state.answers[4];
      return Array.isArray(ans) && ans.includes(1) && ans.includes(2);
    }

    function formatPct(x){ return (x*100).toFixed(0) + "%"; }

    function resultPackage(){
      const { scores, contrib, total } = calcScores();
      const { winner, tied, reason } = pickWinner({ scores, contrib });
      const hybrid = calcHybrid({ scores, total });

      const list = personaOrder
        .map(p => ({ p, score: scores[p], share: total>0 ? scores[p]/total : 0 }))
        .sort((a,b)=> b.score - a.score);

      return { scores, total, winner, tied, reason, hybrid, list };
    }

    function buildSummaryText(res){
      if(!res.hybrid.isDominant){
        return `Hibrit profil: ${personas[res.hybrid.top1.p].title} (${formatPct(res.hybrid.topShare)}) + ${personas[res.hybrid.top2.p].title} (${formatPct(res.hybrid.top2Share)})`;
      }
      return `Kazanan profil: ${personas[res.winner].title} (${formatPct(res.hybrid.topShare)})`;
    }

    function copyToClipboard(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        return navigator.clipboard.writeText(text);
      }
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      return Promise.resolve();
    }

    function render(){
      updateSessionPill();
      updateSideSummary();

      const main = el("#mainCard");
      if(state.step === "start"){
        main.innerHTML = renderStart();
        bindStart();
        return;
      }
      if(state.step === "quiz"){
        main.innerHTML = renderQuiz();
        bindQuiz();
        return;
      }
      if(state.step === "result"){
        main.innerHTML = renderResult();
        bindResult();
        return;
      }
      state.step = "start";
      save();
      main.innerHTML = renderStart();
      bindStart();
    }

    function renderStart(){
      const prog = totalProgress();
      const hasSaved = prog.answeredCount > 0;
      return `
        <div class="cardHeader">
          <div>
            <h2>Görüşme Bilgisi</h2>
            <div class="sub">Opsiyonel alanlar. İstersen boş geç.</div>
          </div>
          <div class="toggleRow">
            ${hasSaved ? `<span class="badge"><strong>Kayıt:</strong> Devam edilebilir</span>` : `<span class="badge"><strong>Kayıt:</strong> Yeni</span>`}
          </div>
        </div>

        <div class="cardBody">
          <div class="stack">
            <div class="fieldRow">
              <label>
                Müşteri Ad Soyad
                <input type="text" id="metaName" placeholder="Örn: Ayşe Yılmaz" value="${escapeHtml(state.meta.name)}" />
              </label>
              <label>
                Telefon
                <input type="tel" id="metaPhone" placeholder="Örn: 05xx xxx xx xx" value="${escapeHtml(state.meta.phone)}" />
              </label>
            </div>

            <div class="fieldRow">
              <label>
                E-posta
                <input type="email" id="metaEmail" placeholder="Örn: ayse@mail.com" value="${escapeHtml(state.meta.email)}" />
              </label>
              <label>
                İç Not (Kısa)
                <input type="text" id="metaQuick" placeholder="Örn: Ada istiyor, teslim acil" value="" />
              </label>
            </div>

            <label>
              Proje Notu
              <textarea id="metaNote" placeholder="Kısa notlar, beklenti, kritik detaylar...">${escapeHtml(state.meta.note)}</textarea>
              <div class="hint">Notlar sadece bu cihazda saklanır.</div>
            </label>

            <div class="navRow">
              <div class="left">
                <button class="btn ghost" id="btnContinue" ${hasSaved ? "" : "disabled"}>Devam Et</button>
                <button class="btn" id="btnStartNew">Ankete Başla</button>
              </div>
              <div class="right">
                <button class="btn danger" id="btnClearSaved">Kaydı Sil</button>
              </div>
            </div>

            <div class="mini">
              İpucu: Kayıt varsa <span class="kbd">Devam Et</span> kaldığın soruya gider. Yoksa 1. sorudan başlar.
            </div>
          </div>
        </div>
      `;
    }

    function renderQuiz(){
      const q = currentQuestion();
      const prog = totalProgress();
      const pct = Math.round(((state.qIndex) / (questions.length - 1)) * 100);
      const answered = isAnswered(q);

      const selected = state.answers[q.id];
      const optionHtml = q.options.map((o, idx) => {
        const isSel = q.type === "single"
          ? selected === idx
          : (Array.isArray(selected) && selected.includes(idx));

        const cls = ["opt", q.type === "multi" ? "multi" : "", isSel ? "sel" : ""].join(" ").trim();
        return `
          <div class="${cls}" data-opt="${idx}" role="button" tabindex="0" aria-pressed="${isSel}">
            <div>
              <div class="t">${escapeHtml(o.text)}</div>
              <div class="tag">${q.type === "multi" ? "Çoklu seçim" : "Tek seçim"}</div>
            </div>
            <div class="mark" aria-hidden="true"></div>
          </div>
        `;
      }).join("");

      const canNext = answered;
      const isLast = state.qIndex === questions.length - 1;

      return `
        <div class="progressWrap">
          <div class="progressLeft">
            <div class="qMeta">Soru ${state.qIndex + 1} / ${questions.length} • Cevaplanan: ${prog.answeredCount}/${prog.total}</div>
            <p class="qText">${escapeHtml(q.text)}</p>
          </div>
          <div class="bar" aria-label="İlerleme">
            <div style="width:${pct}%"></div>
          </div>
        </div>

        <div class="cardBody">
          <div class="options" id="optList">${optionHtml}</div>

          <div class="navRow">
            <div class="left">
              <button class="btn ghost" id="btnBack" ${state.qIndex === 0 ? "disabled" : ""}>Geri</button>
              <button class="btn ${isLast ? "primary" : ""}" id="btnNext" ${canNext ? "" : "disabled"}>
                ${isLast ? "Sonucu Gör" : "İleri"}
              </button>
            </div>
            <div class="right">
              <button class="btn ghost" id="btnJumpStart">Başlangıç</button>
              <button class="btn danger" id="btnClearAnswers">Cevapları Temizle</button>
            </div>
          </div>

          <div class="mini">
            ${q.type === "multi" ? "Birden fazla seçenek işaretleyebilirsin. İleri için en az bir seçim şart." : "İleri için seçim şart."}
          </div>
        </div>
      `;
    }

    function renderResult(){
      const res = resultPackage();
      const winnerId = res.winner;
      const winnerData = personas[winnerId];

      const hybrid = res.hybrid;
      const isHybrid = !hybrid.isDominant;

      const pet = petTriggered();
      const risk = childrenAndPetRisk();

      const recBlock = isHybrid
        ? buildHybridRec(personas[hybrid.top1.p], personas[hybrid.top2.p])
        : buildRec(winnerData);


      const scoreTableRows = res.list.map(row => `
        <tr>
          <td><strong>${escapeHtml(personas[row.p].title)}</strong></td>
          <td>${row.score}</td>
          <td>${formatPct(row.share)}</td>
        </tr>
      `).join("");

      return `
        <div class="split bento">
          <div class="panel bento-card bento-meta">
            <h3>Görüşme Bilgisi</h3>
            <div class="stack">
              <div class="fieldRow">
                <label>
                  Müşteri Ad Soyad
                  <input type="text" id="metaNameResult" placeholder="Örn: Ayşe Yılmaz" value="${escapeHtml(state.meta.name)}" />
                </label>
                <label>
                  Telefon
                  <input type="tel" id="metaPhoneResult" placeholder="Örn: 05xx xxx xx xx" value="${escapeHtml(state.meta.phone)}" />
                </label>
              </div>
              <div class="fieldRow">
                <label>
                  E-posta
                  <input type="email" id="metaEmailResult" placeholder="Örn: ayse@mail.com" value="${escapeHtml(state.meta.email)}" />
                </label>
              </div>
              <label>
                Proje Notu
                <textarea id="metaNoteResult" placeholder="Kısa notlar, beklenti, kritik detaylar...">${escapeHtml(state.meta.note || "")}</textarea>
              </label>
            </div>
          </div>

          ${risk ? `
            <div class="panel alert bento-card bento-alert">
              <h3>Sistem Uyarısı: Yüksek Aşınma Riski</h3>
              <ul>
                <li>Kapak önerisi: Tech-Matt (Mat PET) veya Akrilik, daha dayanıklı kullanım.</li>
                <li>Modül önerisi: Çöp ayrıştırma ve çekmece içi düzenleyici ile temizlik akışını hızlandırın.</li>
                <li>Güvenlik: Çocuklar için kilit, hassas yüzeylerde koruma yaklaşımı.</li>
              </ul>
            </div>
          ` : ""}

          <div class="panel bento-card bento-recipe">
            <h3>Öneri Reçetesi</h3>
            ${recBlock}
          </div>

          ${pet ? `
            <div class="panel ok bento-card bento-pet">
              <h3>Pet Modülü Kartı</h3>
              <ul>
                <li>Evcil hayvan mama kabı modülü gibi günlük pratik sağlayan çözümleri gösterin.</li>
                <li>Anti-fingerprint ve kolay silinen yüzey yönünü öne çıkarın.</li>
                <li>Kapalı depolama ve çöp ayrıştırma ile hijyen akışını netleştirin.</li>
              </ul>
            </div>
          ` : ""}

          <div class="panel bento-card bento-scores">
            <h3>Skor Dağılımı</h3>
            <table>
              <thead>
                <tr>
                  <th>Persona</th>
                  <th>Skor</th>
                  <th>Pay</th>
                </tr>
              </thead>
              <tbody>${scoreTableRows}</tbody>
            </table>
            <div class="mini">Dominant kuralı toplam skorun %30 eşiğine göre hesaplanır.</div>
          </div>

          <div class="panel bento-card bento-note">
            <h3>Mimar Notu</h3>
            <textarea id="archNote" placeholder="Kısa satış yönlendirmesi, kritik istekler, takip notu...">${escapeHtml(state.meta.note || "")}</textarea>
            <div class="navRow" style="margin-top:10px;">
              <div class="left">
                <button class="btn ghost" id="btnBackToQuiz">Ankete Dön</button>
              </div>
              <div class="right">
                <button class="btn ghost" id="btnPrint">Yazdır</button>
                <button class="btn primary" id="btnNewFromResult">Yeni Görüşme</button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function buildRec(p){
      const feats = (p.features || []).map(x=>`<li>${escapeHtml(x)}</li>`).join("");
      const modelImage = p.modelImage;
      const colorImage = p.colorImage;
      const accessoryImage = p.accessoryImage;

      return `
        <div class="stack" style="gap:10px;">
          <div class="panel">
            <h3>${escapeHtml(p.title)}</h3>
            <p><strong>${escapeHtml(p.headline)}</strong></p>
            <p>${escapeHtml(p.summary)}</p>
          </div>

          <div class="panel">
            <h3>Model</h3>
            <p><strong>${escapeHtml(p.model)}</strong></p>
          </div>

          <div class="panel">
            <h3>Malzeme ve Renk</h3>
            <ul>
              <li><strong>Malzeme:</strong> ${escapeHtml(p.material)}</li>
        <li><strong>Renk:</strong> ${escapeHtml(p.color)}</li>
            </ul>
          </div>

          <div class="panel">
            <h3>Görsel Referanslar</h3>
            <div class="mediaGrid">
              <div class="mediaCard">
                <img src="${escapeHtml(modelImage)}" alt="Model görseli" loading="lazy" />
                <div class="label">Model</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(colorImage)}" alt="Renk paleti görseli" loading="lazy" />
                <div class="label">Renk</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(accessoryImage)}" alt="Aksesuar görseli" loading="lazy" />
                <div class="label">Aksesuarlar</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <h3>Önerilen Özellikler</h3>
            <ul>${feats}</ul>
          </div>

          <div class="panel">
            <h3>Mimar Notu (Öneri)</h3>
            <p>${escapeHtml(p.architectNote || "")}</p>
          </div>
        </div>
      `;
    }

    function buildHybridRec(a, b){
      const headline = `Hibrit: ${a.title} + ${b.title}`;
      const mergedFeatures = unique([...(a.features||[]), ...(b.features||[])]).slice(0, 8);
      const feats = mergedFeatures.map(x=>`<li>${escapeHtml(x)}</li>`).join("");
      return `
        <div class="stack" style="gap:10px;">
          <div class="panel">
            <h3>${escapeHtml(headline)}</h3>
            <p><strong>${escapeHtml(a.headline)}</strong></p>
            <p>${escapeHtml(a.summary)}</p>
            <p style="margin-top:10px;"><strong>${escapeHtml(b.headline)}</strong></p>
            <p>${escapeHtml(b.summary)}</p>
          </div>

          <div class="panel">
            <h3>Model Yönü</h3>
            <ul>
              <li><strong>${escapeHtml(a.title)}:</strong> ${escapeHtml(a.model)}</li>
              <li><strong>${escapeHtml(b.title)}:</strong> ${escapeHtml(b.model)}</li>
            </ul>
          </div>

          <div class="panel">
            <h3>Malzeme ve Renk</h3>
            <ul>
        <li><strong>${escapeHtml(a.title)}:</strong> Malzeme: ${escapeHtml(a.material)} | Renk: ${escapeHtml(a.color)}</li>
        <li><strong>${escapeHtml(b.title)}:</strong> Malzeme: ${escapeHtml(b.material)} | Renk: ${escapeHtml(b.color)}</li>
            </ul>
          </div>

          <div class="panel">
            <h3>Görsel Referanslar</h3>
            <div class="mediaGrid">
              <div class="mediaCard">
                <img src="${escapeHtml(a.modelImage)}" alt="${escapeHtml(a.title)} model görseli" loading="lazy" />
                <div class="label">${escapeHtml(a.title)} • Model</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(a.colorImage)}" alt="${escapeHtml(a.title)} renk görseli" loading="lazy" />
                <div class="label">${escapeHtml(a.title)} • Renk</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(a.accessoryImage)}" alt="${escapeHtml(a.title)} aksesuar görseli" loading="lazy" />
                <div class="label">${escapeHtml(a.title)} • Aksesuar</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(b.modelImage)}" alt="${escapeHtml(b.title)} model görseli" loading="lazy" />
                <div class="label">${escapeHtml(b.title)} • Model</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(b.colorImage)}" alt="${escapeHtml(b.title)} renk görseli" loading="lazy" />
                <div class="label">${escapeHtml(b.title)} • Renk</div>
              </div>
              <div class="mediaCard">
                <img src="${escapeHtml(b.accessoryImage)}" alt="${escapeHtml(b.title)} aksesuar görseli" loading="lazy" />
                <div class="label">${escapeHtml(b.title)} • Aksesuar</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <h3>Birleşik Özellikler</h3>
            <ul>${feats}</ul>
          </div>

          <div class="panel">
            <h3>Mimar Notları (Öneri)</h3>
            <ul>
              <li><strong>${escapeHtml(a.title)}:</strong> ${escapeHtml(a.architectNote || "")}</li>
              <li><strong>${escapeHtml(b.title)}:</strong> ${escapeHtml(b.architectNote || "")}</li>
            </ul>
          </div>
        </div>
      `;
    }

    function updateSessionPill(){
      const prog = totalProgress();
      el("#sessionState").textContent = (prog.answeredCount > 0) ? `Devam (${prog.answeredCount}/${prog.total})` : "Yeni";
    }

    function updateSideSummary(){
      const side = el("#sideSummary");
      if(!side) return;

      const prog = totalProgress();

      if(state.step === "result"){
        side.textContent = buildSummaryText(resultPackage());
        return;
      }

      if(prog.answeredCount === 0){
        side.textContent = "Başlamak için görüşme bilgisi gir veya direkt ankete başla.";
        return;
      }

      const q = questions[state.qIndex] || questions[0];
      side.textContent = `İlerleme: ${prog.answeredCount}/${prog.total}. Şu an: Soru ${state.qIndex+1}. ${isAnswered(q) ? "Seçildi." : "Seçim bekliyor."}`;
    }

    function bindStart(){
      const name = el("#metaName");
      const phone = el("#metaPhone");
      const email = el("#metaEmail");
      const note = el("#metaNote");
      const quick = el("#metaQuick");

      const sync = () => {
        state.meta.name = name.value.trim();
        state.meta.phone = phone.value.trim();
        state.meta.email = email.value.trim();
        state.meta.note = note.value.trim();
        save();
      };

      [name,phone,email,note].forEach(x => x.addEventListener("input", sync));

      if(quick){
        quick.addEventListener("keydown", (e)=>{
          if(e.key === "Enter"){
            e.preventDefault();
            const v = quick.value.trim();
            if(v){
              state.meta.note = (state.meta.note ? (state.meta.note + "\n") : "") + v;
              quick.value = "";
              save();
              render();
            }
          }
        });
      }

      const prog = totalProgress();
      el("#btnContinue").addEventListener("click", ()=>{
        if(prog.answeredCount === 0) return;
        startQuiz();
      });

      el("#btnStartNew").addEventListener("click", ()=>{
        state.qIndex = 0;
        state.step = "quiz";
        save();
        render();
      });

      el("#btnClearSaved").addEventListener("click", ()=>{
        clearStorage();
        resetAll({ keepMeta:false });
      });
    }

    function bindQuiz(){
      const q = currentQuestion();
      const optList = el("#optList");
      els(".opt", optList).forEach(node => {
        node.addEventListener("click", () => selectOption(q, Number(node.dataset.opt)));
        node.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            selectOption(q, Number(node.dataset.opt));
          }
        });
      });

      el("#btnBack").addEventListener("click", ()=>{
        if(state.qIndex <= 0) return;
        state.qIndex -= 1;
        save();
        render();
      });

      el("#btnNext").addEventListener("click", ()=>{
        if(!isAnswered(q)) return;
        if(state.qIndex >= questions.length - 1){
          state.step = "result";
          save();
          render();
          return;
        }
        state.qIndex += 1;
        save();
        render();
      });

      el("#btnJumpStart").addEventListener("click", ()=>{
        state.step = "start";
        save();
        render();
      });

      el("#btnClearAnswers").addEventListener("click", ()=>{
        state.answers = {};
        state.qIndex = 0;
        save();
        render();
      });
    }

    function bindResult(){
      el("#btnBackToQuiz").addEventListener("click", ()=>{
        state.step = "quiz";
        state.qIndex = questions.length - 1;
        save();
        render();
      });

      el("#btnNewFromResult").addEventListener("click", ()=> resetAll({ keepMeta:true }));

      const note = el("#archNote");
      const name = el("#metaNameResult");
      const phone = el("#metaPhoneResult");
      const email = el("#metaEmailResult");
      const noteResult = el("#metaNoteResult");
      const syncNote = () => {
        state.meta.note = note.value.trim();
        save();
        if(noteResult && noteResult.value !== note.value){
          noteResult.value = note.value;
        }
      };
      const syncMeta = () => {
        state.meta.name = name ? name.value.trim() : "";
        state.meta.phone = phone ? phone.value.trim() : "";
        state.meta.email = email ? email.value.trim() : "";
        if(noteResult){
          state.meta.note = noteResult.value.trim();
          if(note && note.value !== noteResult.value){
            note.value = noteResult.value;
          }
        }
        save();
      };
      [name, phone, email, noteResult].filter(Boolean).forEach((input)=>{
        input.addEventListener("input", syncMeta);
        input.addEventListener("blur", syncMeta);
      });
      note.addEventListener("input", syncNote);
      note.addEventListener("blur", syncNote);

      el("#btnPrint").addEventListener("click", ()=> window.print());
    }

    function flashPill(msg){
      const pill = el("#sessionPill");
      const old = el("#sessionState").textContent;
      el("#sessionState").textContent = msg;
      pill.style.borderColor = "rgba(140,200,255,.42)";
      pill.style.background = "rgba(140,200,255,.16)";
      setTimeout(()=>{
        pill.style.borderColor = "";
        pill.style.background = "";
        el("#sessionState").textContent = old;
      }, 900);
    }

    el("#btnNew").addEventListener("click", ()=> resetAll({ keepMeta:true }));
    el("#btnReset").addEventListener("click", ()=> resetAll({ keepMeta:false }));

    window.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        e.preventDefault();
        resetAll({ keepMeta:true });
        return;
      }
      if(state.step !== "quiz") return;
      if(e.key === "ArrowLeft"){
        e.preventDefault();
        const b = el("#btnBack");
        if(b && !b.disabled) b.click();
      }
      if(e.key === "ArrowRight"){
        e.preventDefault();
        const n = el("#btnNext");
        if(n && !n.disabled) n.click();
      }
    });

    function unique(arr){
      const s = new Set();
      const out = [];
      for(const x of arr){
        if(!s.has(x)){ s.add(x); out.push(x); }
      }
      return out;
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    const hasLoaded = load();
    if(!hasLoaded) save();

    if(state.step === "quiz" && (state.qIndex == null || isNaN(state.qIndex))) state.qIndex = 0;
    if(state.step === "result" && totalProgress().answeredCount === 0) state.step = "start";

    render();
  </script>
</body>
</html>
